{
  "doc_id": "DOC-GUIDE-WS-NEXT-002-FIX-REACHABILITY-ANALYZER-123",
  "id": "ws-next-002-fix-reachability-analyzer",
  "title": "Fix Reachability Analyzer - Add Missing Entry Points",
  "workstream_type": "bugfix",
  "priority": "high",
  "owner": "Code Quality Engineer",
  "status": "not_started",
  "created_date": "2025-12-02",
  "objective": "Fix critical bug in reachability analyzer by adding missing entry points (tests/, tools/, templates/) and implementing cross-validation with grep",
  "problem_statement": "Current analyzer only checks main scripts as entry points, causing false positives for orphaned files that are actually imported by tests, tools, or templates.",
  "scope": {
    "modules": [
      "cleanup_reports/",
      "scripts/"
    ],
    "files_in_scope": [
      "prepare_cleanup.py",
      "scripts/analyze_reachability.py"
    ],
    "files_out_of_scope": [
      "legacy/",
      "archived/"
    ]
  },
  "effort_estimate": {
    "hours": 2,
    "complexity": "medium",
    "risk": "medium"
  },
  "dependencies": {
    "depends_on": [],
    "blocks": [
      "ws-next-004-refactor-2-execution"
    ],
    "prerequisite_tools": [
      "Python 3.10+",
      "grep/ripgrep"
    ]
  },
  "execution_steps": [
    {
      "step": 1,
      "action": "Add missing entry points to analyzer",
      "code_change": "Update ENTRY_POINTS list",
      "file": "prepare_cleanup.py or scripts/analyze_reachability.py",
      "expected_change": "Add tests/, tools/, templates/, UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK/ to entry points"
    },
    {
      "step": 2,
      "action": "Implement cross-validation with grep",
      "code_change": "Add grep-based validation after reachability analysis",
      "pseudocode": "if file_claimed_orphaned: check_with_grep_for_imports()",
      "expected_output": "Warning messages for false positives"
    },
    {
      "step": 3,
      "action": "Add warning system for conflicts",
      "code_change": "Print WARNING when grep finds imports for 'orphaned' files",
      "expected_output": "Clear warnings during analysis"
    },
    {
      "step": 4,
      "action": "Update tests",
      "file": "tests/test_reachability_analyzer.py",
      "expected_change": "Add test cases for new entry points"
    },
    {
      "step": 5,
      "action": "Run validation on current codebase",
      "command": "python prepare_cleanup.py --analyze-only",
      "expected_output": "Updated reachability report with fewer false positives"
    },
    {
      "step": 6,
      "action": "Compare before/after results",
      "command": "diff old_analysis.json new_analysis.json",
      "expected_output": "Fewer orphaned files, more accurate results"
    }
  ],
  "code_changes": [
    {
      "file": "prepare_cleanup.py",
      "change_type": "modify",
      "description": "Add missing entry points",
      "snippet": "ENTRY_POINTS = [\n    'scripts/**/*.py',\n    'tools/**/*.py',\n    'tests/**/*.py',\n    'templates/**/*.py',\n    'UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK/**/*.py',\n    'engine/**/*.py',\n    'core/**/*.py',\n    'error/**/*.py'\n]"
    },
    {
      "file": "prepare_cleanup.py",
      "change_type": "add",
      "description": "Add cross-validation function",
      "snippet": "def cross_validate_with_grep(orphaned_files):\n    for file in orphaned_files:\n        module = path_to_module(file)\n        result = subprocess.run(['grep', '-r', f'from {module}'], capture_output=True)\n        if result.returncode == 0:\n            print(f'WARNING: {file} claimed orphaned but has imports!')\n            print(f'  Found in: {result.stdout.decode()}')"
    }
  ],
  "acceptance_criteria": [
    {
      "criterion": "All entry point directories included",
      "test_method": "Inspect ENTRY_POINTS list",
      "pass_condition": "tests/, tools/, templates/ present"
    },
    {
      "criterion": "Cross-validation implemented",
      "test_method": "Run analyzer on known test case",
      "pass_condition": "Warnings printed for false positives"
    },
    {
      "criterion": "Fewer false positives",
      "test_method": "Compare before/after orphaned file counts",
      "pass_condition": "Significant reduction in claimed orphans"
    },
    {
      "criterion": "Tests pass",
      "test_method": "pytest tests/test_reachability_analyzer.py",
      "pass_condition": "All tests green"
    }
  ],
  "deliverables": [
    {
      "name": "Updated reachability analyzer",
      "description": "Fixed analyzer with complete entry points",
      "location": "prepare_cleanup.py",
      "format": "Python code"
    },
    {
      "name": "Validation report",
      "description": "Before/after comparison showing improvements",
      "location": "reports/ANALYZER_FIX_VALIDATION.md",
      "format": "markdown"
    },
    {
      "name": "Updated tests",
      "description": "Test coverage for new entry points",
      "location": "tests/test_reachability_analyzer.py",
      "format": "Python tests"
    }
  ],
  "risks": [
    {
      "risk": "Breaking existing cleanup automation",
      "mitigation": "Test thoroughly before deploying",
      "severity": "high"
    },
    {
      "risk": "grep performance issues on large codebase",
      "mitigation": "Limit grep scope, use ripgrep if available",
      "severity": "low"
    }
  ],
  "success_metrics": {
    "must_have": [
      "All entry points included",
      "Cross-validation working",
      "Tests pass"
    ],
    "nice_to_have": [
      ">50% reduction in false positives",
      "Performance under 30 seconds",
      "Clear warning messages"
    ]
  }
}
