doc_id: DOC-CONFIG-WS-T01-POWERSHELL-INSTALLER-TEMPLATE-095
# Workstream: PowerShell Installer Template
workstream_id: WS-T01
title: PowerShell Installer Template
pattern: EXEC-001
track: Track 1 - Infrastructure Templates
agent: codex-agent-1

metadata:
  priority: HIGH
  complexity: LOW
  time_estimate_hours: 3
  dependencies: []
  blocked_by: []
  blocks: [WS-T13]

description: |
  Create reusable Jinja2 template for PowerShell installation scripts with:
  - ULID generation for audit trails
  - Phase-based installation structure
  - Validation gates between phases
  - Dry-run mode support
  - JSONL audit logging
  
  Based on existing Install-AutonomousDevStack.ps1 (527 lines).

execution_request:
  tool_id: codex-cli
  worktree: .worktrees/track-1
  constraints:
    file_scope:
      allowed_paths:
        - templates/install_tool.template.ps1
        - templates/_schema/powershell_installer.schema.json
        - templates/_examples/install_tool.example.json
      forbidden_paths:
        - core/**
        - error/**
        - .git/**
  
  prompt: |
    Create a PowerShell installation script template following EXEC-001 pattern.
    
    INPUTS:
    1. Analyze existing script: C:\Users\richg\.claude\file-history\692acdde-afe9-46e5-9e9e-340ab1040cd3\f43d684d853c34be@v2
    2. Extract reusable structure and patterns
    
    OUTPUTS:
    1. templates/_schema/powershell_installer.schema.json
       - Define variables: {phases}, {tools_per_phase}, {validation_gates}
       - JSON Schema format
    
    2. templates/install_tool.template.ps1
       - Jinja2 template with placeholders
       - Include: ULID generation, audit logging, validation gates
       - Support: -Phase, -SkipValidation, -DryRun parameters
    
    3. templates/_examples/install_tool.example.json
       - Sample variables for rendering
       - Test data for validation
    
    GROUND TRUTH GATES:
    - Schema validates against JSON Schema meta-schema
    - Template syntax is valid Jinja2
    - Rendered output is valid PowerShell syntax
    - Dry-run mode executes without errors

validation_gates:
  gate_1_schema_valid:
    command: python -c "import json, jsonschema; schema=json.load(open('templates/_schema/powershell_installer.schema.json')); jsonschema.Draft7Validator.check_schema(schema)"
    expect_exit_code: 0
    failure_action: halt_and_report
  
  gate_2_template_syntax:
    command: python -c "from jinja2 import Template; Template(open('templates/install_tool.template.ps1').read())"
    expect_exit_code: 0
    failure_action: halt_and_report
  
  gate_3_renders_successfully:
    command: python tools/render_template.py templates/install_tool.template.ps1 templates/_examples/install_tool.example.json --output test_install.ps1
    expect_exit_code: 0
    failure_action: halt_and_report
  
  gate_4_powershell_syntax:
    command: pwsh -NoProfile -File test_install.ps1 -DryRun
    expect_exit_code: 0
    failure_action: halt_and_report

acceptance_criteria:
  - Variable schema is valid JSON Schema
  - Template renders without errors
  - Generated script passes PowerShell syntax check
  - Dry-run mode executes successfully
  - ULID generation function is included
  - Validation gates structure is present

rollback_strategy:
  checkpoint_before: true
  rollback_command: git worktree remove --force .worktrees/track-1
  recovery_steps:
    - Delete .worktrees/track-1
    - Remove any created files in templates/

telemetry:
  track:
    - template_creation_time
    - schema_validation_result
    - render_test_result
    - decisions_eliminated
  output: .execution/telemetry/ws-t01.jsonl
