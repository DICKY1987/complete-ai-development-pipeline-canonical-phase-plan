{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "glossary_patch_apply.schema.json",
  "title": "Glossary Patch Apply Pattern Instance",
  "description": "Schema for glossary_patch_apply pattern instances - applies patch specifications to glossary metadata",
  "type": "object",
  "required": [
    "pattern_id",
    "doc_id",
    "inputs"
  ],
  "properties": {
    "pattern_id": {
      "type": "string",
      "const": "PAT-GLOSSARY-PATCH-APPLY-001",
      "description": "Pattern identifier for glossary patch application"
    },
    "doc_id": {
      "type": "string",
      "const": "DOC-GLOSSARY-PATCH-APPLY-001",
      "pattern": "^DOC-[A-Z0-9-]+$",
      "description": "Document ID for this pattern"
    },
    "inputs": {
      "type": "object",
      "required": [
        "project_root",
        "patch_spec_path",
        "dry_run"
      ],
      "properties": {
        "project_root": {
          "type": "string",
          "description": "Root directory of the project (repository root)"
        },
        "patch_spec_path": {
          "type": "string",
          "description": "Path to patch specification YAML file (relative to glossary/updates/)"
        },
        "dry_run": {
          "type": "boolean",
          "default": false,
          "description": "If true, preview changes without applying"
        },
        "validate_after": {
          "type": "boolean",
          "default": true,
          "description": "Run validation after applying patch"
        },
        "update_changelog": {
          "type": "boolean",
          "default": true,
          "description": "Automatically update changelog"
        }
      }
    },
    "outputs": {
      "type": "object",
      "properties": {
        "status": {
          "type": "string",
          "enum": [
            "success",
            "failure",
            "dry_run_complete"
          ],
          "description": "Execution status"
        },
        "patch_id": {
          "type": "string",
          "description": "ID of the applied patch"
        },
        "terms_updated": {
          "type": "integer",
          "description": "Number of terms updated"
        },
        "changes_made": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "term_id": {
                "type": "string"
              },
              "action": {
                "type": "string"
              },
              "field": {
                "type": "string"
              },
              "value": {}
            }
          },
          "description": "List of changes applied"
        },
        "validation_passed": {
          "type": "boolean",
          "description": "Whether post-apply validation passed"
        },
        "execution_duration_seconds": {
          "type": "number",
          "description": "Total execution time in seconds"
        },
        "errors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of errors encountered"
        }
      }
    }
  },
  "doc_id": "DOC-PAT-GLOSSARY-PATCH-APPLY-SCHEMA-070"
}
