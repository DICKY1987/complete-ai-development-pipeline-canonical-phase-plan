{
  "phase_id": "PH-3B",
  "workstream_id": "WS-ORCHESTRATION",
  "phase_name": "Orchestrator Core with State Machine",
  "objective": "Build orchestrator core that manages phase execution lifecycle with state machine (queued→running→complete→failed)",
  "dependencies": ["PH-2C", "PH-3A"],
  "file_scope": [
    "src/orchestrator/core.py",
    "src/orchestrator/state_machine.py",
    "tests/test_orchestrator_core.py"
  ],
  "pre_flight_checks": [
    {
      "check_id": "PFC-3B-001",
      "description": "Validation gateway exists",
      "command": "test -f src/validation_gateway.py",
      "expected": "exit code 0"
    },
    {
      "check_id": "PFC-3B-002",
      "description": "Prompt renderer exists",
      "command": "test -f src/prompt_renderer.py",
      "expected": "exit code 0"
    }
  ],
  "acceptance_tests": [
    {
      "test_id": "AT-3B-001",
      "description": "State machine transitions correctly",
      "command": "python -c 'from src.orchestrator.state_machine import StateMachine; sm = StateMachine(); assert sm.transition(\"queued\", \"running\") == True'",
      "expected": "exit code 0"
    },
    {
      "test_id": "AT-3B-002",
      "description": "Invalid state transitions rejected",
      "command": "python -c 'from src.orchestrator.state_machine import StateMachine; sm = StateMachine(); sm.transition(\"queued\", \"complete\")'",
      "expected": "raises StateTransitionError"
    },
    {
      "test_id": "AT-3B-003",
      "description": "Can queue phase for execution",
      "command": "python src/orchestrator/core.py --queue phase_specs/phase_0_bootstrap.json",
      "expected": "exit code 0, phase state=queued"
    },
    {
      "test_id": "AT-3B-004",
      "description": "Validates phase before queueing",
      "command": "python src/orchestrator/core.py --queue invalid_phase.json",
      "expected": "exit code 1, validation failed"
    },
    {
      "test_id": "AT-3B-005",
      "description": "Tracks phase execution in .ledger/",
      "command": "python src/orchestrator/core.py --queue phase_specs/phase_0_bootstrap.json && test -f .ledger/PH-00.json",
      "expected": "ledger file created with state"
    },
    {
      "test_id": "AT-3B-006",
      "description": "Can retrieve phase status",
      "command": "python src/orchestrator/core.py --status PH-00",
      "expected": "returns current state and metadata"
    },
    {
      "test_id": "AT-3B-007",
      "description": "Unit tests pass",
      "command": "pytest tests/test_orchestrator_core.py -v",
      "expected": "all tests pass (>= 15 tests)"
    }
  ],
  "deliverables": [
    "src/orchestrator/core.py with execution management",
    "src/orchestrator/state_machine.py with state transitions",
    "tests/test_orchestrator_core.py"
  ],
  "estimated_effort_hours": 12,
  "risk_level": "high",
  "notes": "Core orchestration logic - critical component"
}
