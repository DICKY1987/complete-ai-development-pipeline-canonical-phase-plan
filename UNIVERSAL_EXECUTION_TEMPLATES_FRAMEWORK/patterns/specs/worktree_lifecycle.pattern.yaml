doc_id: DOC-PAT-WORKTREE-LIFECYCLE-PATTERN-061
# Pattern: Worktree Lifecycle
# Pattern ID: PAT-WORKTREE-LIFECYCLE-001
# Version: 1.0.0
# Created: 2025-11-24
# Category: infrastructure
# Use Case: Git worktree creation and management
# Time Savings: 75% (25 min â†’ 6 min)

pattern_id: "PAT-WORKTREE-LIFECYCLE-001"
name: "worktree_lifecycle"
version: "1.0.0"
category: "infrastructure"
status: "draft"

metadata:
  created: "2025-11-24"
  author: "UET Framework Team"
  time_savings_vs_manual: "75%"
  estimated_duration_seconds: 360  # 6 minutes

intent: |
  Manage git worktree lifecycle: create, configure, and teardown.
  Enforces consistent worktree structure and naming conventions.
  
  Operations:
  - Create new worktree from branch
  - Configure worktree environment
  - Execute work in worktree
  - Clean up and remove worktree

applicability:
  when_to_use:
    - Parallel feature development
    - Hot-fix while working on feature
    - Testing in isolation
    - CI/CD temporary workspaces
  when_not_to_use:
    - Simple branch switching
    - Long-lived workspaces (use main worktree)
    - Nested worktrees (not supported)
  
  constraints:
    worktree_parent_dir: ".worktrees/"
    naming_convention: "wt-{branch-name}"
    auto_cleanup: true

inputs:
  repository_root:
    type: "string"
    required: true
    
  operation:
    type: "string"
    required: true
    enum: ["create", "execute", "cleanup", "full_lifecycle"]
    
  branch_name:
    type: "string"
    required: true
    description: "Branch to create worktree from"
    
  worktree_name:
    type: "string"
    required: false
    description: "Custom worktree name (default: wt-{branch})"
    
  commands_to_execute:
    type: "array"
    required: false
    description: "Commands to run in worktree context"
    items:
      type: "string"
  
  cleanup_after_execution:
    type: "boolean"
    default: true

outputs:
  worktree_path:
    type: "string"
  branch_created:
    type: "string"
  execution_results:
    type: "array"
  cleanup_performed:
    type: "boolean"

structural_decisions:
  consistent_naming: true
  auto_cleanup_on_error: true
  verify_clean_before_remove: true
  parent_dir_structure: ".worktrees/"

execution_steps:
  - step_id: "S1_create_worktree"
    description: "Create new git worktree"
    actions:
      - "verify_branch_exists_or_create"
      - "create_worktree_directory"
      - "git worktree add"
    
  - step_id: "S2_configure_worktree"
    description: "Configure worktree environment"
    actions:
      - "copy_environment_config"
      - "set_git_config"
      - "initialize_dependencies"
    
  - step_id: "S3_execute_commands"
    description: "Run commands in worktree"
    optional: true
    
  - step_id: "S4_verify_clean"
    description: "Verify worktree has no uncommitted changes"
    
  - step_id: "S5_cleanup"
    description: "Remove worktree"
    actions:
      - "verify_no_uncommitted_changes"
      - "git worktree remove"
      - "cleanup_parent_directory"

performance_profile:
  estimated_time_manual: 1500  # 25 minutes
  estimated_time_pattern: 360  # 6 minutes
  time_savings_percentage: "75%"
  decision_points_eliminated: 6

compliance:
  requirements:
    - "PAT-NAME-001"
    - "PAT-CHECK-001"
