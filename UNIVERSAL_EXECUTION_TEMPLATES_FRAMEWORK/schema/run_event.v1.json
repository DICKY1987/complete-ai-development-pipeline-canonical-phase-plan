{
  "$id": "schema/run_event.v1.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RunEvent v1",
  "description": "Append-only log entry for run observability. Records all state transitions and significant events.",
  "type": "object",
  "additionalProperties": false,
  "required": ["event_id", "run_id", "ts", "kind"],
  "properties": {
    "event_id": {
      "type": "string",
      "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$",
      "description": "Unique identifier for this event (ULID)"
    },
    "run_id": {
      "type": "string",
      "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$",
      "description": "Run this event belongs to"
    },
    "step_attempt_id": {
      "type": ["string", "null"],
      "pattern": "^[0-9A-HJKMNP-TV-Z]{26}$",
      "description": "Optional step attempt this event relates to"
    },
    "ts": {
      "type": "string",
      "format": "date-time",
      "description": "Event timestamp"
    },
    "kind": {
      "type": "string",
      "enum": [
        "run_created",
        "run_started",
        "run_state_changed",
        "tool_call_started",
        "tool_call_completed",
        "tool_call_error",
        "patch_created",
        "patch_validated",
        "patch_apply_started",
        "patch_apply_succeeded",
        "patch_apply_failed",
        "patch_quarantined",
        "error_pipeline_triggered",
        "phase_transition",
        "note"
      ],
      "description": "Type of event"
    },
    "payload": {
      "type": "object",
      "description": "Event-specific data (structure varies by kind)"
    }
  }
}
