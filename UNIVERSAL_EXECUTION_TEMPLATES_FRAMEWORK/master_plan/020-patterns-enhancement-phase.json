[
  {
    "op": "add",
    "path": "/meta/patch_metadata/020",
    "value": {
      "patch_id": "020-patterns-enhancement",
      "patch_ulid": "01JDNW8T00PATCH020PATTERNS001",
      "created_at": "2025-11-24T15:46:15.303Z",
      "description": "Pattern System Enhancement: Shared executor library + Top 3 executors + Quality tools",
      "source_files": [
        "patterns/reports/ENHANCEMENT_PHASE_PLAN.md",
        "patterns/reports/EXECUTIVE_SUMMARY.md"
      ],
      "operations_count": 43,
      "priority": "HIGH",
      "approved_by": "human",
      "applied": false
    }
  },
  {
    "op": "add",
    "path": "/phases/PH-020",
    "value": {
      "phase_id": "PH-020",
      "phase_ulid": "01JDNW8T00PH020PATTERNS001",
      "name": "Pattern System Enhancement",
      "category": "core_dev",
      "description": "Build shared executor library, implement top 3 high-value pattern executors (self_heal, batch_create, verify_commit), and create quality tools (schemas, extractor, dashboard)",
      "priority": "HIGH",
      "status": "ready",
      "estimated_duration_hours": 14,
      "dependencies": [],
      "spec_id": "patterns/reports/ENHANCEMENT_PHASE_PLAN.md",
      "resource_scope": {
        "type": "files",
        "read": [
          "patterns/**/*.yaml",
          "patterns/**/*.ps1",
          "patterns/**/*.json",
          "patterns/**/*.md",
          "core/**/*.py",
          "tests/**/*.py"
        ],
        "write": [
          "patterns/executors/lib/**/*.ps1",
          "patterns/executors/self_heal_executor.ps1",
          "patterns/executors/batch_create_executor.ps1",
          "patterns/executors/verify_commit_executor.ps1",
          "patterns/schemas/*.schema.json",
          "patterns/scripts/pattern_extractor.ps1",
          "patterns/scripts/metrics_dashboard.ps1",
          "patterns/tests/**/*.ps1"
        ],
        "create": [
          "patterns/executors/lib/",
          "patterns/executors/lib/validation.ps1",
          "patterns/executors/lib/templates.ps1",
          "patterns/executors/lib/parallel.ps1",
          "patterns/executors/lib/transactions.ps1",
          "patterns/executors/lib/error_rules.ps1",
          "patterns/executors/lib/testing.ps1",
          "patterns/executors/lib/reporting.ps1"
        ],
        "forbidden": [
          "patterns/registry/PATTERN_INDEX.yaml",
          "patterns/registry/OPERATION_KIND_REGISTRY.yaml",
          "patterns/specs/**/*.pattern.yaml",
          ".git/**",
          ".state/**",
          "legacy/**"
        ]
      },
      "constraints": {
        "patch": {
          "patch_required": true,
          "max_lines_changed": 5000,
          "max_files_changed": 30
        },
        "tests": {
          "tests_must_run": true,
          "tests_must_pass": true,
          "test_command": "pytest patterns/tests/ -v"
        },
        "behavior": {
          "ascii_only": false,
          "require_doc_update": true,
          "code_reuse_target_percent": 70,
          "powershell_version_min": "7.0"
        }
      },
      "acceptance": {
        "mode": "all",
        "checks": [
          {
            "id": "CHECK-001",
            "type": "file_exists",
            "description": "All 7 library modules created",
            "required": true,
            "severity": "critical",
            "files": [
              "patterns/executors/lib/validation.ps1",
              "patterns/executors/lib/templates.ps1",
              "patterns/executors/lib/parallel.ps1",
              "patterns/executors/lib/transactions.ps1",
              "patterns/executors/lib/error_rules.ps1",
              "patterns/executors/lib/testing.ps1",
              "patterns/executors/lib/reporting.ps1"
            ]
          },
          {
            "id": "CHECK-002",
            "type": "file_exists",
            "description": "Top 3 executors implemented",
            "required": true,
            "severity": "critical",
            "files": [
              "patterns/executors/self_heal_executor.ps1",
              "patterns/executors/batch_create_executor.ps1",
              "patterns/executors/verify_commit_executor.ps1"
            ]
          },
          {
            "id": "CHECK-003",
            "type": "syntax_valid",
            "description": "All PowerShell files have valid syntax",
            "required": true,
            "severity": "critical",
            "command": "pwsh -File scripts/validate_powershell_syntax.ps1 patterns/executors/"
          },
          {
            "id": "CHECK-004",
            "type": "test_pass",
            "description": "All executor tests pass",
            "required": true,
            "severity": "critical",
            "command": "pytest patterns/tests/test_*_executor.ps1 -v"
          },
          {
            "id": "CHECK-005",
            "type": "file_exists",
            "description": "6 JSON schemas created",
            "required": true,
            "severity": "high",
            "files": [
              "patterns/schemas/batch_create.schema.json",
              "patterns/schemas/self_heal.schema.json",
              "patterns/schemas/verify_commit.schema.json",
              "patterns/schemas/refactor_patch.schema.json",
              "patterns/schemas/worktree_lifecycle.schema.json",
              "patterns/schemas/module_creation.schema.json"
            ]
          },
          {
            "id": "CHECK-006",
            "type": "file_exists",
            "description": "Quality tools created",
            "required": false,
            "severity": "medium",
            "files": [
              "patterns/scripts/pattern_extractor.ps1",
              "patterns/scripts/metrics_dashboard.ps1"
            ]
          },
          {
            "id": "CHECK-007",
            "type": "code_quality",
            "description": "Library code reuse >= 70%",
            "required": true,
            "severity": "high",
            "command": "python scripts/measure_code_reuse.py --target 70"
          },
          {
            "id": "CHECK-008",
            "type": "documentation",
            "description": "All library functions documented",
            "required": true,
            "severity": "high",
            "command": "python scripts/check_docstrings.py patterns/executors/lib/"
          }
        ],
        "post_actions": [
          "Update patterns/README.md with new executors",
          "Update patterns/reports/IMPLEMENTATION_COMPLETE.md status",
          "Create verification record for phase completion"
        ]
      },
      "workstreams": [
        {
          "workstream_id": "WS-020-A",
          "name": "Phase A: Shared Executor Library",
          "description": "Build 7 reusable library modules for pattern executors",
          "estimated_hours": 4,
          "priority": "CRITICAL",
          "dependencies": [],
          "operations": [
            {
              "operation_id": "OP-020-A-001",
              "operation_kind": "CREATE_FILE",
              "description": "Create validation.ps1 library",
              "params": {
                "path": "patterns/executors/lib/validation.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 60
              },
              "acceptance": {
                "functions_implemented": [
                  "Validate-PatternInstance",
                  "Validate-ProjectStructure",
                  "Validate-FileSyntax",
                  "Validate-Dependencies"
                ],
                "tests_passing": true
              }
            },
            {
              "operation_id": "OP-020-A-002",
              "operation_kind": "CREATE_FILE",
              "description": "Create templates.ps1 library",
              "params": {
                "path": "patterns/executors/lib/templates.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 60
              },
              "acceptance": {
                "functions_implemented": [
                  "Load-Template",
                  "Substitute-Variables",
                  "Validate-TemplateVars"
                ],
                "built_in_templates": ["crud", "model", "test", "config"],
                "tests_passing": true
              }
            },
            {
              "operation_id": "OP-020-A-003",
              "operation_kind": "CREATE_FILE",
              "description": "Create parallel.ps1 library",
              "params": {
                "path": "patterns/executors/lib/parallel.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 45
              },
              "acceptance": {
                "functions_implemented": [
                  "Invoke-ParallelActions",
                  "Invoke-ParallelChecks"
                ],
                "progress_tracking": true,
                "tests_passing": true
              }
            },
            {
              "operation_id": "OP-020-A-004",
              "operation_kind": "CREATE_FILE",
              "description": "Create transactions.ps1 library",
              "params": {
                "path": "patterns/executors/lib/transactions.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 45
              },
              "acceptance": {
                "functions_implemented": [
                  "Begin-FileTransaction",
                  "Commit-FileTransaction",
                  "Rollback-FileTransaction"
                ],
                "atomic_writes": true,
                "tests_passing": true
              }
            },
            {
              "operation_id": "OP-020-A-005",
              "operation_kind": "CREATE_FILE",
              "description": "Create error_rules.ps1 library",
              "params": {
                "path": "patterns/executors/lib/error_rules.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 30
              },
              "acceptance": {
                "functions_implemented": [
                  "Get-FixRule"
                ],
                "built_in_rules": ["import", "indentation", "syntax"],
                "rule_registry_json": true,
                "tests_passing": true
              }
            },
            {
              "operation_id": "OP-020-A-006",
              "operation_kind": "CREATE_FILE",
              "description": "Create testing.ps1 library",
              "params": {
                "path": "patterns/executors/lib/testing.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 30
              },
              "acceptance": {
                "functions_implemented": [
                  "Invoke-TestSuite",
                  "Parse-TestResults"
                ],
                "framework_adapters": ["pytest", "jest", "go test"],
                "tests_passing": true
              }
            },
            {
              "operation_id": "OP-020-A-007",
              "operation_kind": "CREATE_FILE",
              "description": "Create reporting.ps1 library",
              "params": {
                "path": "patterns/executors/lib/reporting.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 30
              },
              "acceptance": {
                "functions_implemented": [
                  "New-ExecutionReport",
                  "New-VerificationRecord"
                ],
                "output_formats": ["JSON", "YAML"],
                "tests_passing": true
              }
            }
          ]
        },
        {
          "workstream_id": "WS-020-B",
          "name": "Phase B: Top 3 Executors",
          "description": "Implement self_heal, batch_create, and verify_commit executors",
          "estimated_hours": 7,
          "priority": "HIGH",
          "dependencies": ["WS-020-A"],
          "operations": [
            {
              "operation_id": "OP-020-B-001",
              "operation_kind": "CREATE_FILE",
              "description": "Build self_heal_executor.ps1",
              "params": {
                "path": "patterns/executors/self_heal_executor.ps1",
                "pattern_id": "PAT-SELF-HEAL-001",
                "base_pattern": "Error-Detect-Fix-Validate",
                "estimated_minutes": 150
              },
              "acceptance": {
                "pattern_compliance": "EDFV",
                "library_reuse_percent": 70,
                "error_detection_implemented": true,
                "fix_application_implemented": true,
                "validation_implemented": true,
                "test_coverage_percent": 80,
                "time_savings_target_percent": 90
              }
            },
            {
              "operation_id": "OP-020-B-002",
              "operation_kind": "CREATE_FILE",
              "description": "Build batch_create_executor.ps1",
              "params": {
                "path": "patterns/executors/batch_create_executor.ps1",
                "pattern_id": "PAT-BATCH-CREATE-001",
                "base_pattern": "Template-Generate-Batch",
                "estimated_minutes": 120
              },
              "acceptance": {
                "pattern_compliance": "TGB",
                "library_reuse_percent": 75,
                "template_loading_implemented": true,
                "parallel_generation_implemented": true,
                "batch_validation_implemented": true,
                "atomic_commit_implemented": true,
                "test_coverage_percent": 80,
                "time_savings_target_percent": 88
              }
            },
            {
              "operation_id": "OP-020-B-003",
              "operation_kind": "CREATE_FILE",
              "description": "Build verify_commit_executor.ps1",
              "params": {
                "path": "patterns/executors/verify_commit_executor.ps1",
                "pattern_id": "PAT-VERIFY-COMMIT-001",
                "base_pattern": "Check-Aggregate-Report",
                "estimated_minutes": 120
              },
              "acceptance": {
                "pattern_compliance": "CAR",
                "library_reuse_percent": 80,
                "parallel_checks_implemented": true,
                "result_aggregation_implemented": true,
                "commit_decision_implemented": true,
                "verification_record_generated": true,
                "test_coverage_percent": 80,
                "time_savings_target_percent": 85
              }
            }
          ]
        },
        {
          "workstream_id": "WS-020-C",
          "name": "Phase C: Schemas & Quality Tools",
          "description": "Create JSON schemas and quality improvement tools",
          "estimated_hours": 4,
          "priority": "MEDIUM",
          "dependencies": ["WS-020-B"],
          "operations": [
            {
              "operation_id": "OP-020-C-001",
              "operation_kind": "CREATE_FILE",
              "description": "Create 6 JSON schemas for core patterns",
              "params": {
                "pattern_id": "PAT-BATCH-CREATE-001",
                "estimated_minutes": 120
              },
              "targets": [
                "patterns/schemas/batch_create.schema.json",
                "patterns/schemas/self_heal.schema.json",
                "patterns/schemas/verify_commit.schema.json",
                "patterns/schemas/refactor_patch.schema.json",
                "patterns/schemas/worktree_lifecycle.schema.json",
                "patterns/schemas/module_creation.schema.json"
              ],
              "acceptance": {
                "schema_valid_json": true,
                "based_on_atomic_create_template": true,
                "validation_rules_complete": true
              }
            },
            {
              "operation_id": "OP-020-C-002",
              "operation_kind": "CREATE_FILE",
              "description": "Build pattern_extractor.ps1",
              "params": {
                "path": "patterns/scripts/pattern_extractor.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 60
              },
              "acceptance": {
                "analyzes_codebase": true,
                "generates_pattern_specs": true,
                "suggests_candidates": true,
                "uses_ast_parsing": true
              }
            },
            {
              "operation_id": "OP-020-C-003",
              "operation_kind": "CREATE_FILE",
              "description": "Build metrics_dashboard.ps1",
              "params": {
                "path": "patterns/scripts/metrics_dashboard.ps1",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 60
              },
              "acceptance": {
                "parses_verification_records": true,
                "calculates_metrics": true,
                "generates_html_report": true,
                "includes_charts": true
              }
            },
            {
              "operation_id": "OP-020-C-004",
              "operation_kind": "EDIT_FILE",
              "description": "Update patterns/README.md with completion status",
              "params": {
                "path": "patterns/README.md",
                "pattern_id": "PAT-ATOMIC-CREATE-001",
                "estimated_minutes": 15
              },
              "acceptance": {
                "executor_count_updated": true,
                "library_modules_documented": true,
                "enhancement_status_marked_complete": true
              }
            }
          ]
        }
      ]
    }
  }
]
