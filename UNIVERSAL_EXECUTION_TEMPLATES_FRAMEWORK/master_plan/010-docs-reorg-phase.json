[
  {
    "op": "add",
    "path": "/meta/patch_metadata/010",
    "value": {
      "patch_id": "010-docs-reorg",
      "patch_ulid": "01JDK9XYZ123PATCH010DOCS001",
      "created_at": "2025-11-23T17:40:00.000Z",
      "description": "Documentation reorganization phase plan implementing DOC-ORG-SPEC-v1.0 with UET integration",
      "source_files": [
        "DOCS_ORGANIZATION_SPEC_v1.0.md"
      ],
      "operations_count": 48,
      "priority": "HIGH",
      "approved_by": "human",
      "applied": false
    }
  },
  {
    "op": "add",
    "path": "/phases/PH-010",
    "value": {
      "phase_id": "PH-010",
      "phase_ulid": "01JDK9XYZ123PH010DOCSREORG",
      "name": "Documentation Reorganization",
      "category": "documentation",
      "description": "Implement DOC-ORG-SPEC-v1.0: inventory, classify, and relocate documentation files into governed directory structure",
      "priority": "HIGH",
      "status": "ready",
      "estimated_duration_hours": 12,
      "dependencies": [],
      "spec_id": "DOC-ORG-SPEC-v1.0",
      "resource_scope": {
        "type": "files",
        "read": [
          "**/*.md",
          "**/*.txt",
          "!.git/**",
          "!.state/**",
          "!.ai/**",
          "!.cache/**",
          "!.venv/**",
          "!**/__pycache__/**",
          "!**/node_modules/**"
        ],
        "write": [
          ".state/docs/**"
        ],
        "create": [
          "docs/spec/**",
          "docs/planning/**",
          "docs/scratch/**",
          "docs/runtime/**",
          "docs/archive/**",
          "docs/ai/**",
          "tools/doc_inventory.py",
          "tools/apply_doc_move_plan.py",
          "tools/validate_doc_org.py",
          "tools/check_doc_orphans.py",
          ".docs_ignore"
        ],
        "forbidden": [
          "legacy/**",
          "src/pipeline/**",
          "MOD_ERROR_PIPELINE/**",
          "docs/adr/**"
        ]
      },
      "constraints": {
        "patch": {
          "patch_required": false,
          "max_lines_changed": 10000,
          "max_files_changed": 500,
          "comment": "Large file moves expected, not code changes"
        },
        "tests": {
          "tests_must_run": true,
          "tests_must_pass": true,
          "test_command": "python tools/validate_doc_org.py"
        },
        "behavior": {
          "ascii_only": false,
          "require_doc_update": true,
          "git_mv_required": true,
          "dry_run_first": true
        }
      },
      "acceptance": {
        "mode": "all",
        "checks": [
          {
            "id": "ac-010-001",
            "type": "file_exists",
            "description": "Inventory file created with valid schema",
            "command": "python tools/validate_doc_org.py --file .state/docs/doc_inventory.jsonl --schema inventory",
            "required": true,
            "severity": "critical"
          },
          {
            "id": "ac-010-002",
            "type": "file_exists",
            "description": "Move plan file created with valid schema",
            "command": "python tools/validate_doc_org.py --file .state/docs/doc_move_plan.jsonl --schema move_plan",
            "required": true,
            "severity": "critical"
          },
          {
            "id": "ac-010-003",
            "type": "validation",
            "description": "All category values are in allowed set",
            "command": "python tools/validate_doc_org.py --check-categories",
            "required": true,
            "severity": "critical"
          },
          {
            "id": "ac-010-004",
            "type": "validation",
            "description": "No moves planned for unknown category",
            "command": "python tools/validate_doc_org.py --check-unknown-moves",
            "required": true,
            "severity": "critical"
          },
          {
            "id": "ac-010-005",
            "type": "validation",
            "description": "All target directories are within docs/ root",
            "command": "python tools/validate_doc_org.py --check-target-dirs",
            "required": true,
            "severity": "critical"
          },
          {
            "id": "ac-010-006",
            "type": "dry_run",
            "description": "Dry run completes without errors",
            "command": "python tools/apply_doc_move_plan.py --plan .state/docs/doc_move_plan.jsonl --dry-run",
            "required": true,
            "severity": "critical"
          },
          {
            "id": "ac-010-007",
            "type": "validation",
            "description": "No orphaned docs remain outside governed directories",
            "command": "python tools/check_doc_orphans.py",
            "required": true,
            "severity": "warning"
          }
        ],
        "post_actions": [
          "git add .state/docs/",
          "git add docs/",
          "git add tools/",
          "git commit -m 'PH-010: Documentation reorganization per DOC-ORG-SPEC-v1.0'"
        ]
      },
      "workstreams": {}
    }
  },
  {
    "op": "add",
    "path": "/phases/PH-010/workstreams/WS-010-001",
    "value": {
      "workstream_id": "WS-010-001",
      "workstream_ulid": "01JDK9XYZ123WS010001SPEC01",
      "project_id": "PRJ-COMPLETE_AI_DEVELOPMENT_PIPELINE",
      "phase_id": "PH-010",
      "name": "Update DOC-ORG Spec",
      "objective": "Apply P0/P1 recommendations to DOCS_ORGANIZATION_SPEC_v1.0",
      "tags": ["spec", "documentation", "governance"],
      "concurrency": {
        "max_parallel": 1
      },
      "error_handling": {
        "strategy": "fail_fast"
      },
      "acceptance": {
        "mode": "all",
        "checks": [
          {
            "id": "ws-010-001-ac-001",
            "description": "Spec moved to specs/ directory",
            "command": "test -f specs/DOCS_ORGANIZATION_SPEC.v1.0.md"
          },
          {
            "id": "ws-010-001-ac-002",
            "description": "All P0 recommendations applied",
            "command": "grep -q '\\.state/docs/' specs/DOCS_ORGANIZATION_SPEC.v1.0.md"
          }
        ]
      },
      "tasks": [
        {
          "task_id": "t-010-001-001",
          "name": "Create .docs_ignore file",
          "kind": "file_create",
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 30
          },
          "execution_request_template": {
            "tool": "filesystem",
            "action": "create",
            "params": {
              "path": ".docs_ignore",
              "content": "# Exclude build artifacts\n**/node_modules/**\n**/dist/**\n**/.venv/**\n**/__pycache__/**\n\n# Exclude state/cache directories\n.state/**\n.ai/**\n.cache/**\n.git/**\n.worktrees/**\n.ledger/**\n.tasks/**\n\n# Exclude chat logs (will be moved to docs/scratch/)\ndocs/scratch/chat_*.md\nCLAUDE_CHAT_*.txt\nchat*.txt\nchat*.md\n\n# Exclude temporary files\ntemp_*.json\ntemp_*.md\n\n# Exclude legacy/deprecated\nlegacy/**\nsrc/pipeline/**\nMOD_ERROR_PIPELINE/**\n"
            }
          }
        },
        {
          "task_id": "t-010-001-002",
          "name": "Update spec: .ai/ → .state/docs/",
          "kind": "file_edit",
          "depends_on": ["t-010-001-001"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 60
          },
          "prompt_template_ref": "edit_spec_file",
          "prompt_overrides": {
            "instructions": "Replace all occurrences of '.ai/doc_inventory.jsonl' with '.state/docs/doc_inventory.jsonl' and '.ai/doc_move_plan.jsonl' with '.state/docs/doc_move_plan.jsonl'. Update DOC-ORG-020 and DOC-ORG-031 sections with rationale about .state/ directory being the canonical location for execution state."
          }
        },
        {
          "task_id": "t-010-001-003",
          "name": "Update spec: Add UET Workstream example",
          "kind": "file_edit",
          "depends_on": ["t-010-001-002"],
          "allow_parallel": false,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 120
          },
          "prompt_template_ref": "add_spec_section",
          "prompt_overrides": {
            "section_id": "DOC-ORG-070",
            "section_title": "UET Integration Example",
            "content": "Add complete YAML workstream example showing how to invoke doc reorganization within UET framework, including task dependencies and tool adapters."
          }
        },
        {
          "task_id": "t-010-001-004",
          "name": "Update spec: Split dev → planning/scratch",
          "kind": "file_edit",
          "depends_on": ["t-010-001-003"],
          "allow_parallel": false,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P1"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 120
          },
          "prompt_template_ref": "edit_spec_file",
          "prompt_overrides": {
            "instructions": "In DOC-ORG-010, replace 'dev' category with two categories: 'planning' (phase plans, workstreams, patches, ADRs) and 'scratch' (chat logs, temporary notes, drafts). Update DOC-ORG-011 table and all references throughout spec."
          }
        },
        {
          "task_id": "t-010-001-005",
          "name": "Update spec: Add Git conflict resolution",
          "kind": "file_edit",
          "depends_on": ["t-010-001-004"],
          "allow_parallel": false,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P1"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 120
          },
          "prompt_template_ref": "add_spec_section",
          "prompt_overrides": {
            "section_id": "DOC-ORG-042a",
            "section_title": "Git-Based Conflict Resolution",
            "content": "Add section describing Git-aware conflict detection and resolution strategy, including conflict logging to .state/docs/move_conflicts.jsonl."
          }
        },
        {
          "task_id": "t-010-001-006",
          "name": "Update spec: Add .docs_ignore pattern matching",
          "kind": "file_edit",
          "depends_on": ["t-010-001-005"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P1"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 120
          },
          "prompt_template_ref": "add_spec_section",
          "prompt_overrides": {
            "section_id": "DOC-ORG-021a",
            "section_title": "Ignore File Format",
            "content": "Add section specifying .docs_ignore file format using glob patterns, with examples."
          }
        },
        {
          "task_id": "t-010-001-007",
          "name": "Update spec: Add Quality Gate integration",
          "kind": "file_edit",
          "depends_on": ["t-010-001-006"],
          "allow_parallel": false,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 120
          },
          "prompt_template_ref": "add_spec_section",
          "prompt_overrides": {
            "section_id": "DOC-ORG-050a",
            "section_title": "Quality Gate Integration",
            "content": "Add section showing how to integrate doc org validation into QUALITY_GATE.yaml with specific check IDs and commands."
          }
        },
        {
          "task_id": "t-010-001-008",
          "name": "Move spec to specs/ directory",
          "kind": "file_move",
          "depends_on": ["t-010-001-007"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 30
          },
          "execution_request_template": {
            "tool": "git",
            "action": "mv",
            "params": {
              "source": "DOCS_ORGANIZATION_SPEC_v1.0.md",
              "destination": "specs/DOCS_ORGANIZATION_SPEC.v1.0.md"
            }
          }
        }
      ]
    }
  },
  {
    "op": "add",
    "path": "/phases/PH-010/workstreams/WS-010-002",
    "value": {
      "workstream_id": "WS-010-002",
      "workstream_ulid": "01JDK9XYZ123WS010002TOOLS1",
      "project_id": "PRJ-COMPLETE_AI_DEVELOPMENT_PIPELINE",
      "phase_id": "PH-010",
      "name": "Build Documentation Tools",
      "objective": "Create inventory, validation, and move application tools per DOC-ORG-SPEC",
      "tags": ["tooling", "python", "documentation"],
      "concurrency": {
        "max_parallel": 2
      },
      "error_handling": {
        "strategy": "fail_fast"
      },
      "acceptance": {
        "mode": "all",
        "checks": [
          {
            "id": "ws-010-002-ac-001",
            "description": "All tools exist and are executable",
            "command": "test -f tools/doc_inventory.py && test -f tools/apply_doc_move_plan.py && test -f tools/validate_doc_org.py && test -f tools/check_doc_orphans.py"
          },
          {
            "id": "ws-010-002-ac-002",
            "description": "Tools have --help documentation",
            "command": "python tools/doc_inventory.py --help && python tools/apply_doc_move_plan.py --help && python tools/validate_doc_org.py --help"
          },
          {
            "id": "ws-010-002-ac-003",
            "description": "Tools pass basic smoke tests",
            "command": "pytest tests/tools/test_doc_tools.py -v"
          }
        ]
      },
      "tasks": [
        {
          "task_id": "t-010-002-001",
          "name": "Create doc_inventory.py",
          "kind": "code_create",
          "allow_parallel": true,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "low",
            "domain": "tooling",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 2,
            "timeout_seconds": 300
          },
          "prompt_template_ref": "create_python_script",
          "prompt_overrides": {
            "requirements": "Implement DOC-ORG-020 through DOC-ORG-024. Walk repository, find *.md and *.txt files, respect .docs_ignore patterns, capture path/name/preview (600 chars default, configurable), write to .state/docs/doc_inventory.jsonl. Include --help, --preview-chars option, --config option for .docs_org_config.json. Use pathlib, UTF-8 with errors='ignore', idempotent (overwrite existing)."
          }
        },
        {
          "task_id": "t-010-002-002",
          "name": "Create validate_doc_org.py",
          "kind": "code_create",
          "allow_parallel": true,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "low",
            "domain": "tooling",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 2,
            "timeout_seconds": 300
          },
          "prompt_template_ref": "create_python_script",
          "prompt_overrides": {
            "requirements": "Implement DOC-ORG-CHK-001 through DOC-ORG-CHK-006. Validate inventory.jsonl and move_plan.jsonl against schemas (DOC-ORG-023-SCHEMA, DOC-ORG-033-SCHEMA). Check category values, target_dir paths, no moves for unknown. Use jsonschema library. Include --file, --schema, --check-categories, --check-unknown-moves, --check-target-dirs options. Exit code 0 on success, non-zero on failure."
          }
        },
        {
          "task_id": "t-010-002-003",
          "name": "Create apply_doc_move_plan.py",
          "kind": "code_create",
          "depends_on": ["t-010-002-002"],
          "allow_parallel": false,
          "classification": {
            "complexity": "complex",
            "risk_tier": "medium",
            "domain": "tooling",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 2,
            "timeout_seconds": 600
          },
          "prompt_template_ref": "create_python_script",
          "prompt_overrides": {
            "requirements": "Implement DOC-ORG-040 through DOC-ORG-043a. Read .state/docs/doc_move_plan.jsonl, validate schema, build move list (src, dst) where target_dir non-empty. Support --dry-run (default, print moves only) and --apply (execute moves). Create missing target dirs. Use git mv when in Git repo. Handle conflicts per DOC-ORG-042a: check git status, abort on modified destinations, log conflicts to .state/docs/move_conflicts.jsonl. Report summary (total/successful/conflicts). Include --plan, --dry-run, --apply options."
          }
        },
        {
          "task_id": "t-010-002-004",
          "name": "Create check_doc_orphans.py",
          "kind": "code_create",
          "depends_on": ["t-010-002-001"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "tooling",
            "priority": "P1"
          },
          "execution": {
            "max_attempts": 2,
            "timeout_seconds": 180
          },
          "prompt_template_ref": "create_python_script",
          "prompt_overrides": {
            "requirements": "Find all *.md and *.txt files NOT in governed directories (docs/spec/, docs/planning/, docs/scratch/, docs/runtime/, docs/archive/, docs/ai/). Respect .docs_ignore. Report orphaned files. Exit code 0 if no orphans, 1 if orphans found. Include --report-only (warning) and --strict (error) modes."
          }
        },
        {
          "task_id": "t-010-002-005",
          "name": "Create tool tests",
          "kind": "test_create",
          "depends_on": ["t-010-002-001", "t-010-002-002", "t-010-002-003", "t-010-002-004"],
          "allow_parallel": false,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "low",
            "domain": "testing",
            "priority": "P1"
          },
          "execution": {
            "max_attempts": 2,
            "timeout_seconds": 300
          },
          "prompt_template_ref": "create_pytest_tests",
          "prompt_overrides": {
            "requirements": "Create tests/tools/test_doc_tools.py with smoke tests for all four tools. Test: inventory generation creates valid JSONL, validation catches schema errors, dry-run doesn't move files, apply creates directories and moves files, conflict detection works, orphan checker finds orphans. Use tmp_path fixtures."
          }
        }
      ]
    }
  },
  {
    "op": "add",
    "path": "/phases/PH-010/workstreams/WS-010-003",
    "value": {
      "workstream_id": "WS-010-003",
      "workstream_ulid": "01JDK9XYZ123WS010003INVEN1",
      "project_id": "PRJ-COMPLETE_AI_DEVELOPMENT_PIPELINE",
      "phase_id": "PH-010",
      "name": "Generate Documentation Inventory",
      "objective": "Scan repository and create doc_inventory.jsonl",
      "tags": ["inventory", "documentation"],
      "concurrency": {
        "max_parallel": 1
      },
      "error_handling": {
        "strategy": "fail_fast"
      },
      "acceptance": {
        "mode": "all",
        "checks": [
          {
            "id": "ws-010-003-ac-001",
            "description": "Inventory file exists",
            "command": "test -f .state/docs/doc_inventory.jsonl"
          },
          {
            "id": "ws-010-003-ac-002",
            "description": "Inventory passes schema validation",
            "command": "python tools/validate_doc_org.py --file .state/docs/doc_inventory.jsonl --schema inventory"
          },
          {
            "id": "ws-010-003-ac-003",
            "description": "Inventory contains expected file count",
            "command": "test $(wc -l < .state/docs/doc_inventory.jsonl) -gt 10"
          }
        ]
      },
      "tasks": [
        {
          "task_id": "t-010-003-001",
          "name": "Create .state/docs/ directory",
          "kind": "directory_create",
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "filesystem",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 10
          },
          "execution_request_template": {
            "tool": "filesystem",
            "action": "mkdir",
            "params": {
              "path": ".state/docs",
              "parents": true
            }
          }
        },
        {
          "task_id": "t-010-003-002",
          "name": "Run doc_inventory.py",
          "kind": "script_execution",
          "depends_on": ["t-010-003-001"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "documentation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 2,
            "timeout_seconds": 120
          },
          "execution_request_template": {
            "tool": "python",
            "action": "run",
            "params": {
              "script": "tools/doc_inventory.py",
              "args": ["--output", ".state/docs/doc_inventory.jsonl", "--preview-chars", "600"]
            }
          }
        },
        {
          "task_id": "t-010-003-003",
          "name": "Validate inventory schema",
          "kind": "validation",
          "depends_on": ["t-010-003-002"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "validation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 30
          },
          "execution_request_template": {
            "tool": "python",
            "action": "run",
            "params": {
              "script": "tools/validate_doc_org.py",
              "args": ["--file", ".state/docs/doc_inventory.jsonl", "--schema", "inventory"]
            }
          }
        }
      ]
    }
  },
  {
    "op": "add",
    "path": "/phases/PH-010/workstreams/WS-010-004",
    "value": {
      "workstream_id": "WS-010-004",
      "workstream_ulid": "01JDK9XYZ123WS010004CLASS1",
      "project_id": "PRJ-COMPLETE_AI_DEVELOPMENT_PIPELINE",
      "phase_id": "PH-010",
      "name": "AI Classification of Documents",
      "objective": "Use AI to classify documents and generate move plan",
      "tags": ["ai", "classification", "documentation"],
      "concurrency": {
        "max_parallel": 1
      },
      "error_handling": {
        "strategy": "fail_fast"
      },
      "acceptance": {
        "mode": "all",
        "checks": [
          {
            "id": "ws-010-004-ac-001",
            "description": "Move plan file exists",
            "command": "test -f .state/docs/doc_move_plan.jsonl"
          },
          {
            "id": "ws-010-004-ac-002",
            "description": "Move plan passes schema validation",
            "command": "python tools/validate_doc_org.py --file .state/docs/doc_move_plan.jsonl --schema move_plan"
          },
          {
            "id": "ws-010-004-ac-003",
            "description": "No unknown category moves planned",
            "command": "python tools/validate_doc_org.py --check-unknown-moves"
          }
        ]
      },
      "tasks": [
        {
          "task_id": "t-010-004-001",
          "name": "AI document classification",
          "kind": "ai_task",
          "allow_parallel": false,
          "classification": {
            "complexity": "complex",
            "risk_tier": "medium",
            "domain": "ai",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 3,
            "timeout_seconds": 600
          },
          "prompt_template_ref": "classify_documents_jsonl",
          "prompt_overrides": {
            "system_prompt": "You are a documentation classifier for a software repository implementing DOC-ORG-SPEC-v1.0. Your task is to classify documentation files into categories: spec, planning, scratch, runtime, archive, ai, unknown.",
            "context_files": [
              ".state/docs/doc_inventory.jsonl",
              "specs/DOCS_ORGANIZATION_SPEC.v1.0.md",
              "CODEBASE_INDEX.yaml",
              "AI_NAVIGATION_SUMMARY.md"
            ],
            "instructions": "Read doc_inventory.jsonl. For each file, analyze the preview and filename. Classify into one category. Use 'planning' for phase plans, workstreams, patches, ADRs. Use 'scratch' for chat logs, temporary notes, drafts. Use 'spec' for canonical specifications. Use 'ai' for AI prompts/instructions. Use 'archive' for deprecated docs. Use 'runtime' for user-facing guides. Use 'unknown' when confidence is low. Map category to target_dir per DOC-ORG-011. Output one JSONL record per file with fields: path, category, target_dir, reason. Write to .state/docs/doc_move_plan.jsonl. Be conservative: when in doubt, use 'unknown'."
          },
          "execution_request_template": {
            "tool": "llm",
            "action": "generate_structured_output",
            "params": {
              "model": "gpt-4-turbo",
              "output_format": "jsonl",
              "output_file": ".state/docs/doc_move_plan.jsonl"
            }
          }
        },
        {
          "task_id": "t-010-004-002",
          "name": "Validate move plan schema",
          "kind": "validation",
          "depends_on": ["t-010-004-001"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "validation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 30
          },
          "execution_request_template": {
            "tool": "python",
            "action": "run",
            "params": {
              "script": "tools/validate_doc_org.py",
              "args": ["--file", ".state/docs/doc_move_plan.jsonl", "--schema", "move_plan"]
            }
          }
        },
        {
          "task_id": "t-010-004-003",
          "name": "Validate categories and targets",
          "kind": "validation",
          "depends_on": ["t-010-004-002"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "validation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 30
          },
          "execution_request_template": {
            "tool": "python",
            "action": "run",
            "params": {
              "script": "tools/validate_doc_org.py",
              "args": ["--check-categories", "--check-unknown-moves", "--check-target-dirs"]
            }
          }
        }
      ]
    }
  },
  {
    "op": "add",
    "path": "/phases/PH-010/workstreams/WS-010-005",
    "value": {
      "workstream_id": "WS-010-005",
      "workstream_ulid": "01JDK9XYZ123WS010005APPLY1",
      "project_id": "PRJ-COMPLETE_AI_DEVELOPMENT_PIPELINE",
      "phase_id": "PH-010",
      "name": "Apply Move Plan",
      "objective": "Execute approved move plan and reorganize documentation files",
      "tags": ["execution", "documentation", "filesystem"],
      "concurrency": {
        "max_parallel": 1
      },
      "error_handling": {
        "strategy": "fail_fast"
      },
      "acceptance": {
        "mode": "all",
        "checks": [
          {
            "id": "ws-010-005-ac-001",
            "description": "All governed directories exist",
            "command": "test -d docs/spec && test -d docs/planning && test -d docs/scratch && test -d docs/runtime && test -d docs/archive && test -d docs/ai"
          },
          {
            "id": "ws-010-005-ac-002",
            "description": "No orphaned docs remain",
            "command": "python tools/check_doc_orphans.py --strict"
          },
          {
            "id": "ws-010-005-ac-003",
            "description": "All moves recorded in git history",
            "command": "git log -1 --oneline | grep 'PH-010'"
          }
        ]
      },
      "tasks": [
        {
          "task_id": "t-010-005-001",
          "name": "Dry run: Apply move plan",
          "kind": "script_execution",
          "allow_parallel": false,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "medium",
            "domain": "filesystem",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 120
          },
          "execution_request_template": {
            "tool": "python",
            "action": "run",
            "params": {
              "script": "tools/apply_doc_move_plan.py",
              "args": ["--plan", ".state/docs/doc_move_plan.jsonl", "--dry-run"]
            }
          }
        },
        {
          "task_id": "t-010-005-002",
          "name": "Human review: Approve move plan",
          "kind": "human_approval",
          "depends_on": ["t-010-005-001"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "critical",
            "domain": "governance",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 86400,
            "comment": "24-hour timeout for human review"
          },
          "prompt_template_ref": "human_approval_request",
          "prompt_overrides": {
            "approval_criteria": "Review dry-run output. Verify target directories are correct. Check for unexpected moves or conflicts. Approve to proceed with file moves."
          }
        },
        {
          "task_id": "t-010-005-003",
          "name": "Apply: Execute move plan",
          "kind": "script_execution",
          "depends_on": ["t-010-005-002"],
          "allow_parallel": false,
          "classification": {
            "complexity": "moderate",
            "risk_tier": "high",
            "domain": "filesystem",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 300,
            "comment": "Single attempt only - reversible via Git"
          },
          "execution_request_template": {
            "tool": "python",
            "action": "run",
            "params": {
              "script": "tools/apply_doc_move_plan.py",
              "args": ["--plan", ".state/docs/doc_move_plan.jsonl", "--apply"]
            }
          }
        },
        {
          "task_id": "t-010-005-004",
          "name": "Check for orphaned documents",
          "kind": "validation",
          "depends_on": ["t-010-005-003"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "validation",
            "priority": "P1"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 60
          },
          "execution_request_template": {
            "tool": "python",
            "action": "run",
            "params": {
              "script": "tools/check_doc_orphans.py",
              "args": ["--report-only"]
            }
          }
        },
        {
          "task_id": "t-010-005-005",
          "name": "Git commit: Documentation reorganization",
          "kind": "git_commit",
          "depends_on": ["t-010-005-004"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "version_control",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 60
          },
          "execution_request_template": {
            "tool": "git",
            "action": "commit",
            "params": {
              "message": "PH-010: Documentation reorganization per DOC-ORG-SPEC-v1.0\n\nWorkstream: WS-010-005\nSpec: specs/DOCS_ORGANIZATION_SPEC.v1.0.md\n\n- Moved docs to governed directories (spec/planning/scratch/runtime/archive/ai)\n- Created .state/docs/ for inventory and move plan\n- Applied AI classification with human review\n- All moves tracked via git mv for rename preservation\n\nSee .state/docs/doc_move_plan.jsonl for complete move log.",
              "add_all": true
            }
          }
        }
      ]
    }
  },
  {
    "op": "add",
    "path": "/phases/PH-010/workstreams/WS-010-006",
    "value": {
      "workstream_id": "WS-010-006",
      "workstream_ulid": "01JDK9XYZ123WS010006GATE01",
      "project_id": "PRJ-COMPLETE_AI_DEVELOPMENT_PIPELINE",
      "phase_id": "PH-010",
      "name": "Update Quality Gates",
      "objective": "Integrate doc org validation into QUALITY_GATE.yaml",
      "tags": ["quality", "governance", "validation"],
      "concurrency": {
        "max_parallel": 1
      },
      "error_handling": {
        "strategy": "fail_fast"
      },
      "acceptance": {
        "mode": "all",
        "checks": [
          {
            "id": "ws-010-006-ac-001",
            "description": "QUALITY_GATE.yaml updated with doc org checks",
            "command": "grep -q 'qc-docs-org' QUALITY_GATE.yaml"
          },
          {
            "id": "ws-010-006-ac-002",
            "description": "Quality gates pass validation",
            "command": "python scripts/validate_quality_gate.py"
          }
        ]
      },
      "tasks": [
        {
          "task_id": "t-010-006-001",
          "name": "Add doc org quality checks to QUALITY_GATE.yaml",
          "kind": "file_edit",
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "configuration",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 60
          },
          "prompt_template_ref": "edit_yaml_file",
          "prompt_overrides": {
            "instructions": "Add three quality checks to QUALITY_GATE.yaml per DOC-ORG-050a: qc-docs-org-inventory-valid, qc-docs-org-plan-valid, qc-docs-org-no-orphans. Include check_id, description, command, severity (blocking for first two, warning for orphans)."
          }
        },
        {
          "task_id": "t-010-006-002",
          "name": "Validate QUALITY_GATE.yaml schema",
          "kind": "validation",
          "depends_on": ["t-010-006-001"],
          "allow_parallel": false,
          "classification": {
            "complexity": "simple",
            "risk_tier": "low",
            "domain": "validation",
            "priority": "P0"
          },
          "execution": {
            "max_attempts": 1,
            "timeout_seconds": 30
          },
          "execution_request_template": {
            "tool": "python",
            "action": "run",
            "params": {
              "script": "scripts/validate_quality_gate.py"
            }
          }
        }
      ]
    }
  }
]
