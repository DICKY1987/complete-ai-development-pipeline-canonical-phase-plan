# Pattern: Multi-Workstream Doc Suite Generation
# Pattern ID: PAT-MULTI-WORKSTREAM-DOC-PAT-MULTI-WORKSTREAM-DOC-SUITE-GEN-001
# doc_id: DOC-PAT-MULTI-WORKSTREAM-DOC-PAT-MULTI-WORKSTREAM-DOC-SUITE-GEN-001
# Version: 1.0.0
# Category: code_generation
# Status: active

doc_id: "DOC-PAT-MULTI-WORKSTREAM-DOC-PAT-MULTI-WORKSTREAM-DOC-SUITE-GEN-001"
pattern_id: "PAT-MULTI-WORKSTREAM-DOC-PAT-MULTI-WORKSTREAM-DOC-SUITE-GEN-001"
name: "multi_workstream_doc_suite_generation"
version: "1.0.0"
category: "code_generation"
status: "active"
role: "spec"

schema_ref: "patterns/schemas/multi_workstream_doc_suite_generation.schema.json"
executor_ref: "patterns/executors/multi_workstream_doc_suite_generation_executor.ps1"
example_dir: "patterns/examples/multi_workstream_doc_suite_generation/"

operation_kinds:
  - GENERATE_PATTERN_SUITE
  - PARALLEL_WORKSTREAM_EXECUTION
  - DOC_SUITE_VALIDATION

metadata:
  created: "2025-11-24"
  author: "UET Framework Team"
  purpose: "Generate complete pattern doc suites for multiple templates in parallel"
  use_case: "Bulk pattern documentation generation"

intent: |
  Generate 100% complete pattern documentation suites for multiple template files
  simultaneously using parallel workstream execution. Each doc suite includes all
  8 required files per PATTERN_DOC_SUITE_SPEC-V1.

applicability:
  when_to_use:
    - Multiple templates need complete doc suites
    - Need to maintain consistency across all patterns
    - Want to leverage parallel execution for speed
    - Must comply with PATTERN_DOC_SUITE_SPEC-V1

  when_not_to_use:
    - Single template (use atomic_create pattern)
    - Templates already have complete doc suites
    - Custom documentation structure required

inputs:
  templates:
    type: "array"
    required: true
    description: "List of template files requiring doc suites"
    items:
      type: "object"
      required: ["name", "source_path", "category"]
      properties:
        name:
          type: "string"
          description: "Pattern name (snake_case)"
        source_path:
          type: "string"
          description: "Path to source template YAML"
        category:
          type: "string"
          description: "Pattern category"
          enum: ["sequential", "parallel", "meta", "template", "verification", "execution"]

  workstream_config:
    type: "object"
    required: false
    default:
      parallel_workstreams: 4
      templates_per_workstream: 3
    properties:
      parallel_workstreams:
        type: "integer"
        minimum: 1
        maximum: 8
        description: "Number of parallel workstreams"
      templates_per_workstream:
        type: "integer"
        description: "Max templates per workstream"

  doc_id_format:
    type: "string"
    required: false
    default: "DOC-PAT-{NAME}-{NNN}"
    description: "Format for generating doc_ids"

  validation_mode:
    type: "string"
    required: false
    default: "comprehensive"
    enum: ["quick", "standard", "comprehensive"]
    description: "Level of validation to perform"

outputs:
  generated_suites:
    type: "array"
    description: "List of successfully generated doc suites"
    items:
      type: "object"
      properties:
        pattern_name:
          type: "string"
        doc_id:
          type: "string"
        pattern_id:
          type: "string"
        files_generated:
          type: "array"
          items:
            type: "string"
        validation_status:
          type: "string"

  validation_results:
    type: "object"
    properties:
      pat_check_001:
        type: "string"
        enum: ["PASS", "FAIL"]
      doc_id_consistency:
        type: "string"
        enum: ["PASS", "FAIL"]
      schema_validation:
        type: "string"
        enum: ["PASS", "FAIL"]
      total_checks:
        type: "integer"
      passed:
        type: "integer"
      failed:
        type: "integer"

  execution_report:
    type: "object"
    properties:
      total_templates:
        type: "integer"
      total_files_generated:
        type: "integer"
      total_duration_seconds:
        type: "number"
      workstreams_used:
        type: "integer"
      wall_clock_time_seconds:
        type: "number"

execution_steps:
  - step_id: "S1_preparation"
    description: "Generate IDs and prepare registry entries"
    parallel: false
    actions:
      - action: "load_existing_registry"
        file: "patterns/registry/PATTERN_INDEX.yaml"

      - action: "extract_existing_ids"
        extract:
          - doc_ids
          - pattern_ids

      - action: "generate_doc_ids"
        for_each: "templates"
        algorithm: "name_to_doc_id"
        format: "DOC-PAT-{NAME}-{NNN}"
        ensure_unique: true

      - action: "generate_pattern_ids"
        for_each: "templates"
        algorithm: "name_to_pattern_id"
        format: "PAT-{NAME}-{NNN}"
        ensure_unique: true

      - action: "create_id_mapping_file"
        output: "patterns/registry/template_doc_id_mapping.json"

    validation:
      - type: "id_format"
        check: "all doc_ids match ^DOC-PAT-[A-Z0-9-]+-[0-9]{3}$"

      - type: "uniqueness"
        check: "no duplicate doc_ids or pattern_ids"

    reporting:
      on_success: "Generated IDs for {count} templates"
      on_failure: "ID generation failed: {error}"

  - step_id: "S2_parallel_workstream_execution"
    description: "Generate doc suites in parallel workstreams"
    parallel: true
    workstreams: 4

    workstream_assignment:
      - workstream_id: "WS1"
        templates: ["create_test_commit", "grep_view_edit", "view_edit_verify"]

      - workstream_id: "WS2"
        templates: ["batch_file_creation", "decision_elimination_bootstrap"]

      - workstream_id: "WS3"
        templates: ["module_creation_convergence", "preflight_verify", "pytest_green_verify"]

      - workstream_id: "WS4"
        templates: ["atomic_create_template"]

    per_template_steps:
      - step: "parse_source_template"
        action: "load_and_parse"
        extract:
          - structure
          - inputs
          - outputs
          - metadata

      - step: "generate_spec_file"
        template: "spec_template.yaml"
        output: "patterns/specs/{pattern_name}.pattern.yaml"
        inject:
          - doc_id
          - pattern_id
          - parsed_content

      - step: "generate_schema_file"
        template: "schema_template.json"
        output: "patterns/schemas/{pattern_name}.schema.json"
        inject:
          - doc_id
          - pattern_id
          - input_properties

      - step: "generate_sidecar_file"
        template: "sidecar_template.yaml"
        output: "patterns/schemas/{pattern_name}.schema.id.yaml"
        inject:
          - doc_id
          - pattern_id
          - file_paths

      - step: "generate_executor"
        template: "executor_template.ps1"
        output: "patterns/executors/{pattern_name}_executor.ps1"
        inject:
          - doc_id
          - pattern_id
          - doc_link_header

      - step: "generate_test"
        template: "test_template.ps1"
        output: "patterns/tests/test_{pattern_name}_executor.ps1"
        inject:
          - doc_id
          - pattern_id
          - doc_link_header

      - step: "generate_examples"
        count: 3
        outputs:
          - "patterns/examples/{pattern_name}/instance_minimal.json"
          - "patterns/examples/{pattern_name}/instance_full.json"
          - "patterns/examples/{pattern_name}/instance_test.json"
        inject:
          - doc_id
          - pattern_id
          - input_values

      - step: "validate_generated_files"
        checks:
          - json_syntax
          - yaml_syntax
          - powershell_syntax
          - doc_id_presence

    validation:
      - type: "file_count"
        check: "8 files generated per template"

      - type: "syntax_valid"
        check: "all files pass syntax validation"

      - type: "doc_id_consistent"
        check: "same doc_id across all files in suite"

    reporting:
      on_success: "Workstream {ws_id}: Generated {count} doc suites"
      on_failure: "Workstream {ws_id}: Failed on template {template_name}"

  - step_id: "S3_registry_update"
    description: "Update PATTERN_INDEX.yaml with new entries"
    parallel: false
    depends_on: "S2_parallel_workstream_execution"

    actions:
      - action: "backup_registry"
        file: "patterns/registry/PATTERN_INDEX.yaml"
        backup: "patterns/registry/PATTERN_INDEX.yaml.backup"

      - action: "generate_registry_entries"
        for_each: "generated_suites"
        template: "registry_entry_template.yaml"

      - action: "append_to_registry"
        file: "patterns/registry/PATTERN_INDEX.yaml"
        preserve_formatting: true

      - action: "update_metadata"
        fields:
          - total_patterns
          - last_updated

    validation:
      - type: "yaml_valid"
        check: "registry is valid YAML"

      - type: "entry_count"
        check: "all new entries present"

    reporting:
      on_success: "Registry updated with {count} new patterns"
      on_failure: "Registry update failed: {error}"

  - step_id: "S4_cross_suite_validation"
    description: "Comprehensive validation of all doc suites"
    parallel: false
    depends_on: "S3_registry_update"

    validation_scripts:
      - script: "scripts/PATTERN_DIR_CHECK.ps1"
        name: "PAT-CHECK-001 Compliance"
        expect_exit_code: 0

      - script: "scripts/validate_doc_id_consistency.ps1"
        name: "doc_id Consistency"
        expect_exit_code: 0

      - script: "scripts/validate_all_schemas.ps1"
        name: "Schema Validation"
        expect_exit_code: 0

    test_execution:
      - framework: "Pester"
        command: "Invoke-Pester patterns/tests/test_*_executor.ps1 -Output Detailed"
        expect: "all tests pass"

    validation:
      - type: "compliance_check"
        requirement: "PAT-CHECK-001"
        status: "PASS"

      - type: "compliance_check"
        requirement: "ID-SYSTEM-SPEC-V1"
        status: "PASS"

    reporting:
      on_success: "✓ ALL VALIDATION PASSED"
      on_failure: "✗ VALIDATION FAILURES: {failures}"

  - step_id: "S5_documentation"
    description: "Generate completion report and documentation"
    parallel: false
    depends_on: "S4_cross_suite_validation"

    actions:
      - action: "generate_completion_report"
        output: "patterns/DOC_SUITE_GENERATION_REPORT.md"
        include:
          - templates_processed
          - files_generated
          - validation_results
          - doc_id_mappings

      - action: "update_pattern_catalog"
        file: "patterns/README.md"
        add_entries: true

      - action: "create_quick_reference"
        output: "patterns/registry/PATTERN_QUICK_REFERENCE.md"
        format: "table"

    reporting:
      on_success: "Documentation generated"
      on_failure: "Documentation generation failed"

ground_truth_criteria:
  required:
    - criterion: "all_suites_complete"
      description: "All templates have 8-file doc suites"
      verification: "file_count_check"

    - criterion: "all_validations_pass"
      description: "All validation scripts pass"
      verification: "validation_results"

    - criterion: "doc_id_compliance"
      description: "All doc_ids match PATTERN_DOC_SUITE_SPEC format"
      verification: "format_check"

    - criterion: "cross_artifact_consistency"
      description: "Same doc_id across all files in each suite"
      verification: "consistency_check"

    - criterion: "pat_check_001_compliance"
      description: "Full PAT-CHECK-001 compliance"
      verification: "PATTERN_DIR_CHECK.ps1"

error_handling:
  - error_type: "workstream_failure"
    response: "isolate_and_continue"
    action: "mark failed template, continue with others"

  - error_type: "validation_failure"
    response: "rollback_failed_suite"
    action: "delete files for failed template"

  - error_type: "registry_update_failure"
    response: "restore_backup"
    action: "restore PATTERN_INDEX.yaml from backup"

performance_profile:
  estimated_time_manual: 97200  # 27 hours
  estimated_time_pattern: 3600   # 1 hour wall-clock (4 workstreams)
  time_savings_seconds: 93600
  time_savings_percentage: "96%"

  templates_processed: 9
  files_generated: 72
  workstreams: 4
  average_time_per_template: 240  # 4 minutes

compliance:
  specifications:
    - PATTERN_DOC_SUITE_SPEC-V1
    - ID-SYSTEM-SPEC-V1
    - PAT-CHECK-001-v2

  quality_gates:
    - pat_check_001_pass
    - doc_id_consistency_pass
    - schema_validation_pass
    - test_execution_pass
