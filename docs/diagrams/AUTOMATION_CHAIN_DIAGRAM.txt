# MINI_PIPE Automation Chain Diagram

```
═══════════════════════════════════════════════════════════════════════════════
                        MINI_PIPE AUTOMATION CHAIN MAP
                           (Current State Analysis)
═══════════════════════════════════════════════════════════════════════════════

Legend:
  [MANUAL]         - Requires human trigger/input (automation_class: MANUAL)
  [SEMI-MANUAL]    - Runs automatically but produces mock/incomplete results
  [AUTOMATED]      - Fully automated when triggered
  ⛔ BREAK-XXX    - Chain break (automation gap)
  ✓ WORKING       - Component functioning correctly
  ✗ BROKEN        - Component non-functional/mock


┌─────────────────────────────────────────────────────────────────────────────┐
│                         PRIMARY PIPELINE: ACMS                              │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────┐
    │  [MANUAL]            │
    │  Developer           │
    │  python              │
    │  acms_controller.py  │
    └──────────┬───────────┘
               │
               │ ⛔ BREAK-001: No automated trigger
               │    - No scheduling (cron, GitHub Actions)
               │    - No event-based (commit hooks, file watchers)
               │    - Impact: 2h/month manual triggering
               │    - Fix: Create .github/workflows/acms-pipeline.yml
               ▼
    ┌──────────────────────┐
    │  [AUTOMATED] ✓       │
    │  PHASE 0:            │
    │  Run Configuration   │
    │  - Create run_id     │
    │  - Init state files  │
    │  - Create ledger     │
    └──────────┬───────────┘
               │
               │ State: .acms_runs/<run_id>/
               │        ├── acms_state.json
               │        └── run.ledger.jsonl
               ▼
    ┌──────────────────────┐
    │  [SEMI-MANUAL] ✗     │
    │  PHASE 1:            │
    │  Gap Discovery       │
    │  - AI Adapter: mock  │
    │  - Prompt loaded ✓   │
    │  - Output: fake gaps │
    └──────────┬───────────┘
               │
               │ ⛔ BREAK-002: Mock AI adapter
               │    - Default: ai_adapter_type="mock"
               │    - Returns placeholder gaps, not real analysis
               │    - Impact: 100% real gaps missed
               │    - Fix: Implement GitHubCopilotAdapter
               │
               │ Artifacts: gap_analysis_report.json
               │            gap_registry.json
               ▼
    ┌──────────────────────┐
    │  [AUTOMATED] ✓       │
    │  PHASE 2:            │
    │  Gap Consolidation   │
    │  - Clustering works  │
    │  - Workstreams valid │
    │  - UET compliant     │
    └──────────┬───────────┘
               │
               │ Artifacts: workstreams.json
               │            workstreams/*.json
               ▼
    ┌──────────────────────┐
    │  [AUTOMATED] ✓       │
    │  PHASE 3:            │
    │  Plan Generation     │
    │  - Tasks compiled    │
    │  - Dependencies OK   │
    │  - Guardrails active │
    └──────────┬───────────┘
               │
               │ ⚠️  BREAK-003: Planning loop detection but no auto-fix
               │    - Guardrails detect planning loops
               │    - But no automated simplification
               │    - Impact: Requires manual intervention if loops
               │    - Fix: Add auto-simplification logic
               │
               │ Artifacts: mini_pipe_execution_plan.json
               ▼
    ┌──────────────────────┐
    │  [SEMI-MANUAL] ✗     │
    │  PHASE 4:            │
    │  Execution           │
    │  - Adapter: mock     │
    │  - No real tools run │
    │  - Returns fake OK   │
    └──────────┬───────────┘
               │
               │ ⛔ BREAK-004: Mock execution
               │    - orchestrator_cli_path not found
               │    - Falls back to _mock_execution()
               │    - Returns fake "completed" status
               │    - Impact: 0% changes actually applied
               │    - Fix: Use orchestrator as library, not subprocess
               │
               │ Artifacts: execution_results.json (fake)
               ▼
    ┌──────────────────────┐
    │  [AUTOMATED] ✓       │
    │  PHASE 5:            │
    │  Summary & Report    │
    │  - JSON generated    │
    │  - Stats computed    │
    │  - Ledger finalized  │
    └──────────┬───────────┘
               │
               │ ⛔ BREAK-006: No report distribution
               │    - summary_report.json saved to disk
               │    - No email sent
               │    - No Slack notification
               │    - Impact: 4h/month checking manually
               │    - Fix: Create NotificationService
               │
               │ Artifacts: summary_report.json
               │            run_status.json
               ▼
    ┌──────────────────────┐
    │  [MISSING]           │
    │  Report Delivery     │
    │  - Email ✗           │
    │  - Slack ✗           │
    │  - Dashboard ✗       │
    └──────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                      SUPPORTING PIPELINE: TESTING                           │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────┐
    │  [MANUAL]            │
    │  Developer           │
    │  pytest              │
    └──────────┬───────────┘
               │
               │ ⛔ BREAK-007: No CI integration
               │    - No .github/workflows/ci.yml
               │    - Tests not run on commits
               │    - Impact: 10h/month manual testing
               │    - Fix: Create CI workflow
               ▼
    ┌──────────────────────┐
    │  [AUTOMATED] ✓       │
    │  (when triggered)    │
    │  - Unit tests        │
    │  - Integration tests │
    │  - E2E tests         │
    │  - 25+ test files    │
    └──────────┬───────────┘
               │
               │ ⚠️  BREAK-008: Test results not persisted
               │    - Results printed to console
               │    - Not saved to central state
               │    - No trend analysis
               │    - Fix: Add test result persistence + reporting
               ▼
    ┌──────────────────────┐
    │  [MISSING]           │
    │  Test Reporting      │
    │  - Coverage report ✗ │
    │  - Trend analysis ✗  │
    │  - Quality gates ✗   │
    └──────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                   SUPPORTING PIPELINE: VALIDATION                           │
└─────────────────────────────────────────────────────────────────────────────┘

    ┌──────────────────────┐
    │  [MANUAL]            │
    │  python              │
    │  validate_           │
    │  everything.py       │
    └──────────┬───────────┘
               │
               │ ⚠️  BREAK-009: Validation isolated
               │    - Excellent tool exists
               │    - Not part of ACMS pipeline
               │    - Not in CI
               │    - Fix: Integrate into Phase 5 + CI
               ▼
    ┌──────────────────────┐
    │  [AUTOMATED] ✓       │
    │  (when triggered)    │
    │  - Schema validation │
    │  - All JSON files    │
    │  - Clear errors      │
    └──────────────────────┘


┌─────────────────────────────────────────────────────────────────────────────┐
│                    MONITORING & OBSERVABILITY (MISSING)                     │
└─────────────────────────────────────────────────────────────────────────────┘

    State Files Generated:           Monitoring Consumer:
    ───────────────────────          ──────────────────────
    .acms_runs/*/                    [MISSING]
      ├── run.ledger.jsonl    ──╳──▶ No monitoring service
      ├── acms_state.json     ──╳──▶ No alerting
      ├── gap_registry.json   ──╳──▶ No dashboard
      ├── workstreams.json    ──╳──▶ No trend analysis
      └── summary_report.json
    
    ⛔ BREAK-010: State files not monitored
       - Excellent state persistence exists
       - But nothing consumes it
       - No alerts on failures
       - No trending of gap discovery
       - Fix: Create StateAggregator + Healthchecks.io integration


┌─────────────────────────────────────────────────────────────────────────────┐
│                         ERROR HANDLING CHAIN                                │
└─────────────────────────────────────────────────────────────────────────────┘

    Error occurs in Phase 1-5
              │
              ▼
    ┌──────────────────────┐
    │  Exception caught    │
    │  - Logged to ledger  │
    │  - State → FAILED    │
    └──────────┬───────────┘
              │
              │ ⚠️  BREAK-011: No error escalation
              │    - Error logged but not alerted
              │    - No Slack/email notification
              │    - Developer must check manually
              │
              ▼
    ┌──────────────────────┐
    │  [MANUAL]            │
    │  Developer reviews   │
    │  ledger manually     │
    └──────────┬───────────┘
              │
              │ ⚠️  BREAK-012: No automated recovery
              │    - No retry logic
              │    - No rollback on failure
              │    - Manual rerun required
              │
              ▼
    ┌──────────────────────┐
    │  [MANUAL]            │
    │  Developer re-runs   │
    │  entire pipeline     │
    └──────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                              QUICK WIN FIXES
═══════════════════════════════════════════════════════════════════════════════

Priority 1 (Week 1): Close Critical Chain Breaks
─────────────────────────────────────────────────

1. BREAK-001: Automated Trigger (2 hours)
   ┌──────────────────────┐
   │  GitHub Actions      │
   │  Workflow:           │
   │  scheduled-acms.yml  │
   │  - cron: daily 2 AM  │
   │  - workflow_dispatch │
   └──────────────────────┘

2. BREAK-007: CI Integration (6 hours)
   ┌──────────────────────┐
   │  GitHub Actions      │
   │  Workflows:          │
   │  - ci.yml (tests)    │
   │  - lint.yml (quality)│
   └──────────────────────┘

3. BREAK-006: Report Distribution (6 hours)
   ┌──────────────────────┐
   │  NotificationService │
   │  - Email via SMTP    │
   │  - Slack webhook     │
   │  - HTML formatting   │
   └──────────────────────┘

4. BREAK-010: Monitoring (4 hours)
   ┌──────────────────────┐
   │  HealthcheckMonitor  │
   │  - ping_start()      │
   │  - ping_success()    │
   │  - ping_failure()    │
   └──────────────────────┘

Result: 65% automation coverage from 40%
        16 hours/month time savings


Priority 2 (Week 2-4): Replace Mock Implementations
────────────────────────────────────────────────────

5. BREAK-002: Real AI Adapter (8 hours)
   ┌──────────────────────┐
   │  GitHubCopilotAdapter│
   │  - Use gh copilot    │
   │  - Parse responses   │
   │  - Real gap detection│
   └──────────────────────┘

6. BREAK-004: Real Execution (16 hours)
   ┌──────────────────────┐
   │  MiniPipeAdapter     │
   │  - Direct orchestrate│
   │  - Real tool calls   │
   │  - Actual changes    │
   └──────────────────────┘

Result: 85% automation coverage
        34 hours/month time savings (cumulative)


═══════════════════════════════════════════════════════════════════════════════
                            AUTOMATION METRICS
═══════════════════════════════════════════════════════════════════════════════

Current State:
──────────────
  Automation Coverage:        40%
  Manual Steps per Run:       3 (trigger, check results, distribute)
  Fully Automated Steps:      5 (Phases 0, 2, 3, 5 - when triggered)
  Semi-Manual Steps:          2 (Phases 1, 4 - mock data)
  Manual Steps:               1 (Trigger)
  Chain Breaks:               12
  Critical Breaks:            5
  Time per Run:               45 minutes (30 min manual + 15 min execution)
  Runs per Month:             ~30 (when remembered)

Target State (After Phase 1):
──────────────────────────────
  Automation Coverage:        65%
  Manual Steps per Run:       0 (fully automated)
  Fully Automated Steps:      7 (all phases when triggered)
  Semi-Manual Steps:          2 (Phases 1, 4 still mock)
  Manual Steps:               0
  Chain Breaks:               7 (5 fixed)
  Critical Breaks:            2 (BREAK-002, BREAK-004 remain)
  Time per Run:               15 minutes (automated)
  Runs per Month:             30 (scheduled daily)

Target State (After Phase 2):
──────────────────────────────
  Automation Coverage:        85%
  Manual Steps per Run:       0
  Fully Automated Steps:      9 (all phases with real implementations)
  Semi-Manual Steps:          0
  Manual Steps:               0
  Chain Breaks:               5 (7 fixed)
  Critical Breaks:            0 (all fixed!)
  Time per Run:               20 minutes (real execution)
  Runs per Month:             30 (scheduled daily)

Final Target (After Phase 4):
──────────────────────────────
  Automation Coverage:        95%
  Manual Steps per Run:       0
  Fully Automated Steps:      10+ (with monitoring, rollback, etc.)
  Semi-Manual Steps:          0
  Manual Steps:               0
  Chain Breaks:               1-2 (edge cases only)
  Critical Breaks:            0
  Time per Run:               15 minutes (optimized)
  Runs per Month:             30 (scheduled daily)


═══════════════════════════════════════════════════════════════════════════════
                              NEXT STEPS
═══════════════════════════════════════════════════════════════════════════════

✓ Analysis Complete
⏭  Review AUTOMATION_CHAIN_ANALYSIS_REPORT.md (full details)
⏭  Review AUTOMATION_CHAIN_ANALYSIS_SUMMARY.md (exec summary)
⏭  Approve Phase 1 implementation plan (21 hours)
⏭  Begin Week 1 implementation:
    1. Create .github/workflows/ (8 hours)
    2. Create src/acms/notifications.py (6 hours)
    3. Create src/acms/monitoring.py (4 hours)
    4. Install pre-commit hooks (1 hour)
    5. Integrate validation (2 hours)

Expected Completion: Week 2
Expected Result: 65% automation, 16h/month savings, automated CI/CD pipeline
