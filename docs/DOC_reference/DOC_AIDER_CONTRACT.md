---
status: draft
doc_type: guide
module_refs: []
script_refs: []
doc_id: DOC-GUIDE-AIDER_CONTRACT-074
---

# Aider Integration Contract (AIDER_CONTRACT_V1)

This document specifies how the pipeline integrates with the Aider CLI for EDIT and FIX steps.

## Overview
- Aider is invoked by the pipeline’s tool adapter using a dedicated profile `aider`.
- Prompts are generated via `src/pipeline/prompts.py` from templates in `aider/templates/prompts/` and written under `<worktree>/.aider/prompts/`.
- Aider runs inside a dedicated git worktree for the active workstream.

## Requirements
- Binary: `aider` is available on PATH.
- Version: >= 0.x (to be validated in future phases). Check with: `aider --version`.
- Python 3.12+ environment to run the pipeline.

## CLI Invocation
Canonical command rendered by the tool adapter:

- `aider --no-auto-commits --yes --model {model_name} --message-file {prompt_file}`
- Working directory: `{worktree_path}` (a git-initialized worktree).
- Defaults (overridable):
  - `model_name`: from context or `AIDER_MODEL` env; default `gpt-4o-mini`.
  - `prompt_file`: path generated by `prepare_aider_prompt_file`.
  - `timeout_sec`: 1800 seconds (profile default).

Always-on flags:
- `--no-auto-commits` and environment `AIDER_NO_AUTO_COMMITS=1` to forbid automatic commits.
- `--yes` to avoid interactive confirmations.

## Environment Variables
- Required: provider API keys as appropriate for the configured model (managed outside this repo).
- Optional: `AIDER_MODEL` to override default model; proxy/base URL settings if needed.
- Never commit secrets. Use user environment or secret store.

## Git & Worktree Expectations
- A clean, dedicated worktree per workstream; `.git` must be reachable from working directory.
- Aider must not implicitly commit or push; commits are orchestrated by later phases.

## I/O & Behavior Expectations
- Aider reads current files from the worktree.
- Aider edits only files in the declared `files_scope` and may create files in `files_create`.
- The pipeline enforces scope by constructing prompts and (later phases) by worktree enforcement.

## Error Handling
- Non‑zero exit code → failure of the Aider step. The adapter returns a `ToolResult` with `success=False` and the exit code.
- Timeout → exit code `-1`; captured as `timed_out=True`.
- Binary not found → exit code `-2`.
- Other execution errors → exit code `-3`.
- The helper records a `tool_run` event in the DB with the serialized `ToolResult` when `run_id`/`ws_id` are provided.

## Contract Versioning
- CONTRACT_VERSION: `AIDER_CONTRACT_V1`.
- Future changes that affect flags, environment, or expectations will bump this string and update this file.


