{
  "spec_metadata": {
    "spec_id": "PH-TRACK-001",
    "name": "GitHub Project Autonomic Tracking for Issues and Milestones",
    "version": "0.1.0",
    "status": "draft",
    "intended_consumer": "agentic_ai_orchestrator",
    "description": "Keep GitHub Project(s) automatically updated as issues, pull requests, and milestones are completed using built-in Project automations, GitHub Actions, and the Projects GraphQL API."
  },
  "targets": {
    "github_organization": "<ORG_NAME>",
    "github_repository": "<REPO_NAME>",
    "github_projects_v2": [
      {
        "logical_name": "phase_plan_project",
        "project_number": 1,
        "project_node_id": "<PROJECT_NODE_ID>",
        "status_field_id": "<PROJECT_STATUS_FIELD_ID>",
        "status_field_options": {
          "todo": "<STATUS_OPTION_ID_TODO>",
          "in_progress": "<STATUS_OPTION_ID_IN_PROGRESS>",
          "in_review": "<STATUS_OPTION_ID_IN_REVIEW>",
          "done": "<STATUS_OPTION_ID_DONE>"
        },
        "phase_field_id": "<PROJECT_PHASE_FIELD_ID>",
        "completion_field_id": "<PROJECT_COMPLETION_FIELD_ID>",
        "milestone_link_field_id": "<PROJECT_MILESTONE_FIELD_ID>"
      }
    ]
  },
  "sections": {
    "builtin_project_automation": {
      "section_id": "SEC_BUILTIN_AUTOMATION",
      "goal": "Configure GitHub Projects built-in workflows to track basic issue and PR status changes.",
      "requirements": [
        "GitHub Projects (Projects v2) enabled for the target repository or organization.",
        "User with permission to edit project workflows."
      ],
      "project_rules": [
        {
          "rule_id": "RULE_AUTO_ADD_ISSUES_PR",
          "project_logical_name": "phase_plan_project",
          "description": "Automatically add newly created issues and pull requests to the phase plan project.",
          "rule_type": "auto_add_items",
          "conditions": {
            "item_types": ["issue", "pull_request"],
            "repositories": ["<REPO_NAME>"],
            "optional_label_filter": null
          },
          "effects": {
            "add_to_project": true,
            "initial_status": "todo"
          }
        },
        {
          "rule_id": "RULE_ISSUE_CLOSED_SET_DONE",
          "project_logical_name": "phase_plan_project",
          "description": "When an issue is closed, set the project Status field to Done.",
          "rule_type": "status_update",
          "conditions": {
            "item_type": "issue",
            "event": "closed"
          },
          "effects": {
            "status_field_id": "<PROJECT_STATUS_FIELD_ID>",
            "status_option_id": "<STATUS_OPTION_ID_DONE>"
          }
        },
        {
          "rule_id": "RULE_PR_MERGED_SET_DONE",
          "project_logical_name": "phase_plan_project",
          "description": "When a pull request is merged, set the project Status field to Done.",
          "rule_type": "status_update",
          "conditions": {
            "item_type": "pull_request",
            "event": "merged"
          },
          "effects": {
            "status_field_id": "<PROJECT_STATUS_FIELD_ID>",
            "status_option_id": "<STATUS_OPTION_ID_DONE>"
          }
        }
      ]
    },
    "github_actions_issue_pr_sync": {
      "section_id": "SEC_ACTIONS_ISSUE_PR_SYNC",
      "goal": "Use a GitHub Actions workflow to ensure that any issue or PR related to the repo is attached to the project and that key fields (Status, Phase) remain consistent.",
      "workflow_descriptor": {
        "workflow_id": "WF_PROJECT_ITEM_SYNC",
        "file_path": ".github/workflows/project_item_sync.yml",
        "triggers": {
          "on_issues": [
            "opened",
            "edited",
            "labeled",
            "unlabeled",
            "closed",
            "reopened"
          ],
          "on_pull_request": [
            "opened",
            "edited",
            "ready_for_review",
            "converted_to_draft",
            "closed",
            "reopened",
            "synchronize"
          ]
        },
        "logic": {
          "high_level_steps": [
            "Determine whether the event came from an issue or pull request.",
            "Compute or derive the desired project Phase based on labels, branch naming, or title patterns.",
            "Ensure an item exists in the target project for this issue/PR (create if missing).",
            "Update Status field based on issue/PR state (open/closed, merged).",
            "Update Phase field based on derived phase mapping."
          ],
          "phase_mapping_rules": [
            {
              "match_type": "label",
              "label": "phase-0",
              "phase_value": "Phase 0"
            },
            {
              "match_type": "label",
              "label": "phase-1",
              "phase_value": "Phase 1"
            },
            {
              "match_type": "label",
              "label": "phase-2",
              "phase_value": "Phase 2"
            },
            {
              "match_type": "label",
              "label": "phase-3",
              "phase_value": "Phase 3"
            }
          ]
        },
        "implementation_template_yaml": "name: Project Item Sync\\n\\non:\\n  issues:\\n    types: [opened, edited, labeled, unlabeled, closed, reopened]\\n  pull_request:\\n    types: [opened, edited, ready_for_review, converted_to_draft, closed, reopened, synchronize]\\n\\njobs:\\n  sync-project-item:\\n    runs-on: ubuntu-latest\\n    permissions:\\n      issues: read\\n      pull-requests: read\\n      project: write\\n      contents: read\\n    steps:\\n      - name: Checkout\\n        uses: actions/checkout@v4\\n\\n      - name: Set up Python\\n        uses: actions/setup-python@v5\\n        with:\\n          python-version: '3.x'\\n\\n      - name: Install dependencies\\n        run: pip install requests\\n\\n      - name: Run project sync script\\n        env:\\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\\n          TARGET_ORG: \"<ORG_NAME>\"\\n          TARGET_REPO: \"<REPO_NAME>\"\\n          PROJECT_NUMBER: \"1\"\\n          PHASE_FIELD_ID: \"<PROJECT_PHASE_FIELD_ID>\"\\n          STATUS_FIELD_ID: \"<PROJECT_STATUS_FIELD_ID>\"\\n          STATUS_TODO_ID: \"<STATUS_OPTION_ID_TODO>\"\\n          STATUS_IN_PROGRESS_ID: \"<STATUS_OPTION_ID_IN_PROGRESS>\"\\n          STATUS_DONE_ID: \"<STATUS_OPTION_ID_DONE>\"\\n        run: |\\n          python .github/scripts/project_item_sync.py"
      },
      "supporting_script_template": {
        "file_path": ".github/scripts/project_item_sync.py",
        "language": "python",
        " responsibilities": [
          "Parse the GitHub event payload to determine issue/PR number and type.",
          "Resolve the GitHub Projects v2 project node ID and field IDs (can be configured or cached).",
          "Find or create the project item associated with the issue/PR.",
          "Apply phase mapping based on labels or patterns.",
          "Update the Status field according to the issue/PR state.",
          "Update the Phase field according to derived phase."
        ]
      }
    },
    "github_actions_milestone_completion": {
      "section_id": "SEC_ACTIONS_MILESTONE_COMPLETION",
      "goal": "When all issues and PRs in a milestone are complete, automatically mark the milestone as done and update the corresponding project item.",
      "workflow_descriptor": {
        "workflow_id": "WF_MILESTONE_COMPLETION",
        "file_path": ".github/workflows/milestone_completion.yml",
        "triggers": {
          "on_issues": [
            "closed",
            "reopened"
          ],
          "on_pull_request": [
            "closed",
            "reopened"
          ]
        },
        "logic": {
          "high_level_steps": [
            "When an issue or PR is closed or reopened, detect whether it is associated with a milestone.",
            "If no milestone is attached, exit.",
            "Query all open issues and PRs for that milestone.",
            "If all issues/PRs are closed/merged, mark the milestone as closed (if not already).",
            "Locate or create a project item representing this milestone in the phase plan project.",
            "Update the milestone project item Status to Done and Completion to 100%."
          ]
        },
        "implementation_template_yaml": "name: Milestone Completion Sync\\n\\non:\\n  issues:\\n    types: [closed, reopened]\\n  pull_request:\\n    types: [closed, reopened]\\n\\njobs:\\n  milestone-completion:\\n    runs-on: ubuntu-latest\\n    permissions:\\n      issues: write\\n      pull-requests: read\\n      project: write\\n      contents: read\\n    steps:\\n      - name: Checkout\\n        uses: actions/checkout@v4\\n\\n      - name: Set up Python\\n        uses: actions/setup-python@v5\\n        with:\\n          python-version: '3.x'\\n\\n      - name: Install dependencies\\n        run: pip install requests\\n\\n      - name: Run milestone sync script\\n        env:\\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\\n          TARGET_ORG: \"<ORG_NAME>\"\\n          TARGET_REPO: \"<REPO_NAME>\"\\n          PROJECT_NUMBER: \"1\"\\n          STATUS_FIELD_ID: \"<PROJECT_STATUS_FIELD_ID>\"\\n          STATUS_DONE_ID: \"<STATUS_OPTION_ID_DONE>\"\\n          COMPLETION_FIELD_ID: \"<PROJECT_COMPLETION_FIELD_ID>\"\\n        run: |\\n          python .github/scripts/milestone_completion_sync.py"
      },
      "supporting_script_template": {
        "file_path": ".github/scripts/milestone_completion_sync.py",
        "language": "python",
        " responsibilities": [
          "Read the GitHub event payload to determine the issue/PR and its milestone (if any).",
          "Use the REST API to list all issues and PRs attached to that milestone.",
          "Determine whether all are in a completed state (closed or merged).",
          "If complete, mark the milestone as closed if not already.",
          "Find or create a project item representing this milestone (e.g., by title matching milestone name).",
          "Use GraphQL to set Status=Done and Completion=100% on that project item."
        ]
      }
    },
    "graphql_api_fragments": {
      "section_id": "SEC_GRAPHQL_FRAGMENTS",
      "goal": "Provide reusable GraphQL fragments and mutations for the agentic AI to interact with GitHub Projects v2.",
      "graphql_snippets": {
        "query_project_and_fields": {
          "description": "Resolve project and field IDs by organization, project number, and field names.",
          "query": "query GetProjectFields($org: String!, $projectNumber: Int!) {\\n  organization(login: $org) {\\n    projectV2(number: $projectNumber) {\\n      id\\n      title\\n      fields(first: 50) {\\n        nodes {\\n          ... on ProjectV2FieldCommon {\\n            id\\n            name\\n          }\\n          ... on ProjectV2SingleSelectField {\\n            id\\n            name\\n            options {\\n              id\\n              name\\n            }\\n          }\\n        }\\n      }\\n    }\\n  }\\n}"
        },
        "mutation_add_item_to_project": {
          "description": "Add an issue or pull request to a project.",
          "mutation": "mutation AddItemToProject($projectId: ID!, $contentId: ID!) {\\n  addProjectV2ItemById(input: {projectId: $projectId, contentId: $contentId}) {\\n    item {\\n      id\\n    }\\n  }\\n}"
        },
        "mutation_update_single_select_field": {
          "description": "Update a single-select field (e.g., Status) for a project item.",
          "mutation": "mutation UpdateSingleSelectField($projectId: ID!, $itemId: ID!, $fieldId: ID!, $optionId: String!) {\\n  updateProjectV2ItemFieldValue(input: {\\n    projectId: $projectId,\\n    itemId: $itemId,\\n    fieldId: $fieldId,\\n    value: { singleSelectOptionId: $optionId }\\n  }) {\\n    projectV2Item {\\n      id\\n    }\\n  }\\n}"
        },
        "mutation_update_number_field": {
          "description": "Update a number field (e.g., Completion percentage) for a project item.",
          "mutation": "mutation UpdateNumberField($projectId: ID!, $itemId: ID!, $fieldId: ID!, $numberValue: Float!) {\\n  updateProjectV2ItemFieldValue(input: {\\n    projectId: $projectId,\\n    itemId: $itemId,\\n    fieldId: $fieldId,\\n    value: { number: $numberValue }\\n  }) {\\n    projectV2Item {\\n      id\\n    }\\n  }\\n}"
        }
      }
    }
  },
  "implementation_steps_for_agentic_ai": [
    {
      "step_id": "STEP_01_DISCOVER_PROJECT_IDS",
      "description": "Call the query_project_and_fields GraphQL query to resolve the project node ID and field IDs (Status, Phase, Completion) and populate the placeholders in this JSON spec."
    },
    {
      "step_id": "STEP_02_CREATE_ACTION_FILES",
      "description": "Create the GitHub Actions workflow files and Python scripts in the repository according to the templates in sections github_actions_issue_pr_sync and github_actions_milestone_completion."
    },
    {
      "step_id": "STEP_03_CONFIGURE_SECRETS",
      "description": "Ensure GITHUB_TOKEN is available by default and add any additional required secrets for API access if necessary."
    },
    {
      "step_id": "STEP_04_ENABLE_BUILTIN_RULES",
      "description": "Configure the built-in project automation rules defined in section builtin_project_automation for the target project."
    },
    {
      "step_id": "STEP_05_TEST_WITH_SAMPLE_ITEMS",
      "description": "Create test issues and PRs with various labels and milestones, close/merge them, and verify that project items are automatically added and updated as expected."
    },
    {
      "step_id": "STEP_06_PROMOTE_TO_PRODUCTION",
      "description": "After validation, enable workflows and rules for the real phase plan project and update this spec's status to 'active'."
    }
  ],
  "execution_artifacts": [
    {
      "type": "workflow",
      "path": ".github/workflows/project_item_sync.yml",
      "env_requirements": [
        "PROJECT_NODE_ID",
        "PROJECT_STATUS_FIELD_ID",
        "PROJECT_PHASE_FIELD_ID",
        "STATUS_OPTION_ID_TODO",
        "STATUS_OPTION_ID_IN_PROGRESS",
        "STATUS_OPTION_ID_IN_REVIEW",
        "STATUS_OPTION_ID_DONE",
        "PHASE_OPTION_MAP_JSON (phase-name -> option-id)",
        "PROJECT_TOKEN (optional; falls back to GITHUB_TOKEN)"
      ]
    },
    {
      "type": "workflow",
      "path": ".github/workflows/milestone_completion.yml",
      "env_requirements": [
        "PROJECT_NODE_ID",
        "PROJECT_STATUS_FIELD_ID",
        "PROJECT_COMPLETION_FIELD_ID",
        "STATUS_OPTION_ID_DONE",
        "PROJECT_TOKEN (optional; falls back to GITHUB_TOKEN)"
      ]
    },
    {
      "type": "script",
      "path": ".github/scripts/project_item_sync.py",
      "notes": "Syncs issue/PR items into the project, sets Status and Phase via label mapping; expects phase/status option IDs."
    },
    {
      "type": "script",
      "path": ".github/scripts/milestone_completion_sync.py",
      "notes": "Closes milestones once all items are done, updates milestone draft item with Status Done and Completion percent."
    },
    {
      "type": "script",
      "path": ".github/scripts/project_id_hydration.py",
      "notes": "Helper to fetch project/field IDs and options; write to .github/scripts/id_cache.json for reuse."
    }
  ]
}
