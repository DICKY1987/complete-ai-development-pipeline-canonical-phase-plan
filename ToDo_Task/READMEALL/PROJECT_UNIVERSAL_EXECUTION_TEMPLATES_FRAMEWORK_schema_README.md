# UET Schema Catalog

Complete reference for all JSON schemas defining the UET framework's type contracts.

## Schema Overview

The UET framework uses **17 JSON schemas (v1)** to ensure type-safe operations across all modules. Every data structure is validated against its schema before use.

## Schema Categories

### Execution Schemas

Schemas defining task execution and workflow orchestration.

#### `execution_request.v1.json`
**Purpose**: Format for requesting tool execution via adapters

**Structure**:
```json
{
  "action": "code_edit",
  "domain": "python",
  "context": {
    "files": ["main.py"],
    "instructions": "Add type hints"
  },
  "params": {
    "model": "gpt-4",
    "auto_commit": true
  },
  "timeout": 300
}
```

**Used by**: `core/adapters/`, `core/engine/router.py`

---

#### `execution_result.v1.json`
**Purpose**: Standardized result format from tool execution

**Structure**:
```json
{
  "success": true,
  "stdout": "Files modified: main.py",
  "stderr": "",
  "exit_code": 0,
  "data": {
    "files_changed": 1,
    "lines_added": 15
  },
  "duration": 5.2
}
```

**Used by**: `core/adapters/`, `core/engine/executor.py`

---

#### `task_spec.v1.json`
**Purpose**: Task definition with dependencies and constraints

**Structure**:
```json
{
  "id": "task-1",
  "name": "Implement user auth",
  "action": "code_edit",
  "domain": "python",
  "depends_on": ["task-0"],
  "priority": 1,
  "timeout": 300,
  "retry_policy": {
    "max_retries": 3,
    "backoff": "exponential"
  }
}
```

**Used by**: `core/engine/scheduler.py`, `core/engine/executor.py`

---

#### `phase_spec.v1.json`
**Purpose**: Phase definition with inputs, outputs, and workstreams

**Structure**:
```json
{
  "name": "implement",
  "description": "Implementation phase",
  "inputs": {
    "required": ["analysis_results", "design_doc"],
    "optional": ["existing_code"]
  },
  "outputs": {
    "artifacts": ["source_code", "tests"],
    "state": "implementation_complete"
  },
  "workstreams": [
    {
      "name": "code_editing",
      "tasks": ["task-1", "task-2"]
    }
  ],
  "depends_on": ["analyze"]
}
```

**Used by**: `core/engine/orchestrator.py`, `core/bootstrap/`

---

### Configuration Schemas

Schemas for project and tool configuration.

#### `profile.v1.json`
**Purpose**: Project profile structure (generated by bootstrap)

**Structure**:
```json
{
  "profile_name": "software-dev-python",
  "version": "1.0.0",
  "project_path": "/path/to/project",
  "detected_languages": {
    "python": 95,
    "yaml": 5
  },
  "detected_frameworks": ["pytest", "flask"],
  "detected_tools": ["git", "ruff"],
  "phases": [
    {
      "name": "analyze",
      "workstreams": ["code_analysis"]
    }
  ],
  "constraints": {
    "max_parallel_tasks": 3,
    "timeout_default": 300
  }
}
```

**Used by**: `core/bootstrap/`, `profiles/`

---

#### `router_config.v1.json`
**Purpose**: Tool routing and capability configuration

**Structure**:
```json
{
  "tools": {
    "aider": {
      "adapter_type": "subprocess",
      "capabilities": {
        "domains": ["python", "code"],
        "actions": ["edit", "refactor"]
      },
      "config": {
        "command": "aider",
        "timeout": 300,
        "max_retries": 3
      }
    }
  },
  "routing_rules": {
    "python_code_edit": ["aider", "cursor"],
    "python_testing": ["pytest"]
  },
  "fallback_strategy": "best_match"
}
```

**Used by**: `core/engine/router.py`, `core/adapters/registry.py`

---

### State Schemas

Schemas for execution state and persistence.

#### `run_state.v1.json`
**Purpose**: Execution run state structure

**Structure**:
```json
{
  "id": "run-123",
  "workflow_id": "wf-abc",
  "status": "RUNNING",
  "started_at": "2024-11-23T10:00:00Z",
  "completed_at": null,
  "total_tasks": 10,
  "completed_tasks": 5,
  "failed_tasks": 0,
  "current_phase": "implement",
  "metadata": {
    "user": "ai-agent",
    "trigger": "manual"
  }
}
```

**Used by**: `core/state/run_manager.py`

---

#### `task_state.v1.json`
**Purpose**: Individual task state

**Structure**:
```json
{
  "id": "task-1",
  "run_id": "run-123",
  "status": "COMPLETED",
  "started_at": "2024-11-23T10:01:00Z",
  "completed_at": "2024-11-23T10:01:05Z",
  "duration": 5.2,
  "retries": 0,
  "result": {
    "success": true,
    "output": "Task completed"
  }
}
```

**Used by**: `core/state/run_manager.py`

---

#### `checkpoint.v1.json`
**Purpose**: State checkpoint snapshot

**Structure**:
```json
{
  "id": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "run_id": "run-123",
  "created_at": "2024-11-23T10:05:00Z",
  "state_snapshot": {
    "completed_tasks": ["task-1", "task-2"],
    "current_phase": "implement",
    "phase_data": {...}
  }
}
```

**Used by**: `core/state/checkpoint.py`

---

### Workflow Schemas

Schemas for workflow definition and orchestration.

#### `workflow.v1.json`
**Purpose**: Complete workflow definition

**Structure**:
```json
{
  "id": "wf-123",
  "name": "Python Project Workflow",
  "description": "End-to-end Python development",
  "phases": [
    {
      "name": "analyze",
      "workstreams": [...]
    },
    {
      "name": "implement",
      "depends_on": ["analyze"],
      "workstreams": [...]
    }
  ],
  "metadata": {
    "created_by": "bootstrap",
    "version": "1.0.0"
  }
}
```

**Used by**: `core/engine/orchestrator.py`

---

#### `workstream.v1.json`
**Purpose**: Workstream definition within a phase

**Structure**:
```json
{
  "name": "code_editing",
  "description": "Edit source code files",
  "domain": "python",
  "tasks": [
    {
      "id": "task-1",
      "action": "edit",
      "context": {...}
    }
  ],
  "constraints": {
    "max_concurrent": 2,
    "timeout": 600
  }
}
```

**Used by**: `core/engine/scheduler.py`

---

### Monitoring Schemas

Schemas for progress tracking and metrics.

#### `progress_snapshot.v1.json`
**Purpose**: Real-time progress snapshot

**Structure**:
```json
{
  "run_id": "run-123",
  "timestamp": "2024-11-23T10:05:00Z",
  "completion_percent": 50.0,
  "tasks_completed": 5,
  "tasks_total": 10,
  "tasks_failed": 0,
  "estimated_completion": "2024-11-23T10:10:00Z",
  "current_phase": "implement",
  "current_tasks": ["task-6"]
}
```

**Used by**: `core/engine/monitoring/progress.py`

---

#### `metrics.v1.json`
**Purpose**: Execution metrics and statistics

**Structure**:
```json
{
  "run_id": "run-123",
  "duration": 300.5,
  "task_count": 10,
  "success_rate": 0.9,
  "average_task_duration": 30.05,
  "retries_total": 3,
  "phase_durations": {
    "analyze": 60.2,
    "implement": 240.3
  }
}
```

**Used by**: `core/engine/monitoring/metrics.py`

---

### Resilience Schemas

Schemas for fault tolerance configuration.

#### `circuit_breaker_state.v1.json`
**Purpose**: Circuit breaker state

**Structure**:
```json
{
  "tool_name": "aider",
  "state": "CLOSED",
  "failure_count": 0,
  "last_failure_time": null,
  "config": {
    "failure_threshold": 5,
    "recovery_timeout": 60
  }
}
```

**Used by**: `core/engine/resilience/circuit_breaker.py`

---

#### `retry_policy.v1.json`
**Purpose**: Retry policy configuration

**Structure**:
```json
{
  "max_retries": 3,
  "base_delay": 1.0,
  "backoff_strategy": "exponential",
  "max_delay": 60.0,
  "retry_on": ["timeout", "network_error"],
  "abort_on": ["validation_error"]
}
```

**Used by**: `core/engine/resilience/executor.py`

---

### Audit Schemas

Schemas for audit logging.

#### `audit_event.v1.json`
**Purpose**: Audit log event format

**Structure**:
```json
{
  "timestamp": "2024-11-23T10:00:00Z",
  "event": "task_started",
  "run_id": "run-123",
  "task_id": "task-1",
  "actor": "ai-agent",
  "metadata": {
    "tool": "aider",
    "action": "code_edit"
  }
}
```

**Used by**: `core/state/audit_log.py`

---

## Schema Validation

### Using Schemas

```python
import json
import jsonschema

# Load schema
with open("schema/task_spec.v1.json") as f:
    schema = json.load(f)

# Validate data
data = {
    "id": "task-1",
    "action": "code_edit",
    "domain": "python"
}

try:
    jsonschema.validate(data, schema)
    print("Valid!")
except jsonschema.ValidationError as e:
    print(f"Invalid: {e.message}")
```

### CLI Validation

```bash
# Validate a file against schema
python -m jsonschema -i data.json schema/task_spec.v1.json

# Validate all schemas
python scripts/validate_schemas.py
```

## Schema Versioning

All schemas are versioned: `*.v1.json`

**Version policy**:
- **v1 â†’ v2**: Breaking changes (incompatible structure)
- **v1.1**: Minor additions (backward compatible)
- **v1.0.1**: Clarifications only (no structure change)

## References

- **Schema specifications**: See individual `.json` files in `schema/`
- **Usage examples**: See module READMEs in `core/`
- **Validation**: `scripts/validate_schemas.py`
