module: "core.adapters"
purpose: "Tool adapters: abstract interface for integrating external tools (CLI, API, custom)"
layer: "api"

entry_points:
  - file: "base.py"
    function: "ToolAdapter"
    description: "Abstract base class for all tool adapters"

  - file: "subprocess_adapter.py"
    function: "SubprocessAdapter"
    description: "Adapter for CLI tools via subprocess execution"

  - file: "registry.py"
    function: "AdapterRegistry"
    description: "Registry for discovering and instantiating adapters based on capabilities"

key_patterns:
  - "All adapters inherit from ToolAdapter base class"
  - "Adapters must implement execute(ExecutionRequest) â†’ ExecutionResult"
  - "SubprocessAdapter is the default/fallback for CLI tools"
  - "Registry matches task requirements to adapter capabilities"
  - "Adapters are stateless - no instance state between calls"

common_tasks:
  - task: "Create custom adapter"
    code: |
      from core.adapters.base import ToolAdapter

      class MyAdapter(ToolAdapter):
          def get_capabilities(self):
              return {"task_kind": "my_task", "tool": "my_tool"}

          def execute(self, request):
              # Implementation
              return ExecutionResult(...)
    approach: "Inherit from ToolAdapter, implement get_capabilities() and execute()"

  - task: "Register adapter"
    code: |
      from core.adapters.registry import AdapterRegistry
      registry = AdapterRegistry()
      registry.register(MyAdapter())
    approach: "Create registry, call register() with adapter instance"

  - task: "Execute via subprocess adapter"
    code: |
      from core.adapters.subprocess_adapter import SubprocessAdapter
      adapter = SubprocessAdapter()
      result = adapter.execute(execution_request)
    approach: "Use SubprocessAdapter for CLI tools"

gotchas:
  - "Adapters should be stateless - no caching or state between calls"
  - "execute() must return ExecutionResult with status, output, error fields"
  - "SubprocessAdapter uses shell=False for security - no shell expansion"
  - "Timeout defaults to 300 seconds (configurable in ExecutionRequest)"
  - "Registry uses first-match for capabilities - order matters"

dependencies:
  external:
    - "subprocess (stdlib)"
  internal: []

status:
  maturity: "stable"
  test_coverage: "90%"
  production_ready: true
  breaking_changes_expected: false

ai_quick_reference:
  create_adapter: "class MyAdapter(ToolAdapter): ..."
  subprocess: "SubprocessAdapter().execute(request)"
  registry: "registry.register(adapter); registry.find(capabilities)"
