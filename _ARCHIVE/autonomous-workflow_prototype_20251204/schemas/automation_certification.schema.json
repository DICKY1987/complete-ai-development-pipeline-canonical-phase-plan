{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://automation.local/schemas/automation_certification.schema.json",
  "title": "Automation Certification",
  "description": "Certification that all automation units are healthy",
  "type": "object",
  "required": [
    "version",
    "certification_id",
    "certified_at",
    "status",
    "summary"
  ],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "certification_id": {
      "type": "string",
      "pattern": "^CERT-[0-9A-Z]{26}$",
      "description": "Unique certification identifier"
    },
    "sweep_id": {
      "type": "string",
      "pattern": "^[0-9A-Z]{26}$",
      "description": "ID of the health sweep that produced this certification"
    },
    "certified_at": {
      "type": "string",
      "format": "date-time"
    },
    "expires_at": {
      "type": "string",
      "format": "date-time",
      "description": "Certification validity expiration"
    },
    "status": {
      "type": "string",
      "enum": [
        "certified",
        "partial",
        "failed",
        "expired",
        "revoked"
      ]
    },
    "summary": {
      "type": "object",
      "required": [
        "automation_units",
        "passing",
        "failing"
      ],
      "properties": {
        "automation_units": {
          "type": "integer",
          "minimum": 0
        },
        "passing": {
          "type": "integer",
          "minimum": 0
        },
        "failing": {
          "type": "integer",
          "minimum": 0
        },
        "skipped": {
          "type": "integer",
          "minimum": 0
        },
        "success_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "sweep_duration_seconds": {
          "type": "number"
        },
        "fixes_applied": {
          "type": "integer",
          "minimum": 0
        },
        "retry_cycles": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "environment": {
      "type": "object",
      "properties": {
        "hostname": {
          "type": "string"
        },
        "os": {
          "type": "string"
        },
        "git_sha": {
          "type": "string"
        },
        "git_branch": {
          "type": "string"
        },
        "git_tag": {
          "type": "string"
        }
      }
    },
    "thresholds": {
      "type": "object",
      "properties": {
        "minimum_success_rate": {
          "type": "number",
          "default": 100
        },
        "max_critical_failures": {
          "type": "integer",
          "default": 0
        },
        "max_high_failures": {
          "type": "integer",
          "default": 0
        }
      }
    },
    "unit_results": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "pass",
              "fail",
              "skip"
            ]
          },
          "attempts": {
            "type": "integer"
          },
          "final_exit_code": {
            "type": "integer"
          },
          "fixes_applied": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    },
    "failing_units": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string"
          },
          "root_cause": {
            "type": "string"
          },
          "escalation_reason": {
            "type": "string"
          }
        }
      }
    },
    "audit_trail": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "event": {
            "type": "string"
          },
          "unit_id": {
            "type": "string"
          },
          "details": {
            "type": "string"
          }
        }
      }
    },
    "signatures": {
      "type": "object",
      "properties": {
        "content_hash": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$",
          "description": "SHA-256 of certification content"
        },
        "signed_by": {
          "type": "string"
        },
        "signature": {
          "type": "string"
        }
      }
    }
  },
  "doc_id": "DOC-CONFIG-AUTOMATION-CERTIFICATION-SCHEMA-294"
}
