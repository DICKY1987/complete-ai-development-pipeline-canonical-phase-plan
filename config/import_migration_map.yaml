# Import Migration Map for EXEC-016
# Maps deprecated import paths to canonical paths

version: "1.0.0"
date: "2025-11-29"
confidence: 100  # Deterministic regex-based migration

# Migration Rules
# Format: deprecated_pattern -> canonical_pattern

migrations:
  # Legacy Pipeline Imports (Deprecated)
  - pattern: "from src\\.pipeline\\.(\\w+)"
    replacement: "from core.\\1"
    description: "Migrate src.pipeline.* to core.*"
    priority: 1
    
  - pattern: "from src\\.pipeline\\.([\\w.]+)"
    replacement: "from core.\\1"
    description: "Migrate nested src.pipeline imports to core"
    priority: 1
    
  - pattern: "import src\\.pipeline\\.(\\w+)"
    replacement: "import core.\\1"
    description: "Migrate src.pipeline import statements to core"
    priority: 1

  # MOD_ERROR_PIPELINE Imports (Deprecated)
  - pattern: "from MOD_ERROR_PIPELINE\\.(\\w+)"
    replacement: "from error.\\1"
    description: "Migrate MOD_ERROR_PIPELINE.* to error.*"
    priority: 1
    
  - pattern: "from MOD_ERROR_PIPELINE\\.([\\w.]+)"
    replacement: "from error.\\1"
    description: "Migrate nested MOD_ERROR_PIPELINE imports to error"
    priority: 1
    
  - pattern: "import MOD_ERROR_PIPELINE\\.(\\w+)"
    replacement: "import error.\\1"
    description: "Migrate MOD_ERROR_PIPELINE import statements to error"
    priority: 1

  # Legacy Module Imports
  - pattern: "from legacy\\.(\\w+)"
    replacement: "# ARCHIVED: from legacy.\\1"
    description: "Comment out legacy imports (archived)"
    priority: 2
    
  # Adapter Corrections
  - pattern: "from adapters\\.(\\w+)"
    replacement: "from core.adapters.\\1"
    description: "Normalize adapter imports"
    priority: 2

  # State Store Corrections
  - pattern: "from state\\.(\\w+)"
    replacement: "from core.state.\\1"
    description: "Normalize state imports"
    priority: 2

  # Engine Corrections
  - pattern: "from engine\\.(\\w+)"
    replacement: "from core.engine.\\1"
    description: "Normalize engine imports"
    priority: 2

  # AIM Corrections
  - pattern: "from aim\\.(\\w+)"
    replacement: "from aim.\\1"
    description: "Normalize AIM imports (already correct)"
    priority: 3

  # Error Plugin Corrections
  - pattern: "from error\\.plugins\\.([\\w.]+)"
    replacement: "from error.plugins.\\1"
    description: "Normalize error plugin imports (already correct)"
    priority: 3

  # UET Framework Corrections
  - pattern: "from UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK\\.(\\w+)"
    replacement: "from UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK.\\1"
    description: "Normalize UET imports (already correct)"
    priority: 3

# Deprecated Modules (Never Import)
deprecated_modules:
  - "src.pipeline"
  - "src.pipeline.*"
  - "MOD_ERROR_PIPELINE"
  - "MOD_ERROR_PIPELINE.*"
  - "legacy"
  - "legacy.*"
  - "archive"
  - "archive.*"

# Canonical Import Patterns
canonical_patterns:
  core:
    - "core.state.*"
    - "core.engine.*"
    - "core.adapters.*"
    - "core.interfaces.*"
  
  error:
    - "error.engine.*"
    - "error.plugins.*"
    - "error.shared.*"
  
  aim:
    - "aim.environment.*"
    - "aim.registry.*"
    - "aim.bridge"
  
  pm:
    - "pm.commands.*"
    - "pm.integrations.*"
    - "pm.rules.*"
  
  specifications:
    - "specifications.tools.*"
    - "specifications.bridge.*"
  
  uet:
    - "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK.core.*"
    - "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK.adapters.*"
    - "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK.engine.*"
    - "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK.monitoring.*"
    - "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK.patterns.*"

# Validation Rules
validation:
  # Patterns that should never appear
  forbidden_patterns:
    - "from src\\.pipeline"
    - "import src\\.pipeline"
    - "from MOD_ERROR_PIPELINE"
    - "import MOD_ERROR_PIPELINE"
    - "from legacy\\."
    - "import legacy\\."
  
  # Required format
  required_format:
    - "Absolute imports only (no relative imports from top-level)"
    - "Section-based paths (core.*, error.*, etc.)"
    - "No direct module names (e.g., 'from db' â†’ 'from core.state.db')"

# Batch Processing
batching:
  # Order of execution (dependencies first)
  execution_order:
    - "tests/"      # Leaf modules first
    - "scripts/"
    - "modules/"
    - "error/"
    - "aim/"
    - "pm/"
    - "core/"       # Root modules last
  
  batch_size: 25    # Files per batch
  test_after_batch: true

# Expected Results
estimates:
  total_files: 300
  total_import_changes: 800
  priority_1_changes: 600  # src.pipeline, MOD_ERROR_PIPELINE
  priority_2_changes: 150  # Adapter/state/engine normalization
  priority_3_changes: 50   # Already correct, validation only
  batches: 12
  execution_time_minutes: 60

# Grace Period (Shims)
shims:
  create_shims: true
  shim_grace_period_days: 30
  shim_locations:
    - "src/pipeline/__init__.py"  # Forward to core
    - "MOD_ERROR_PIPELINE/__init__.py"  # Forward to error

# Shim Template
shim_template: |
  # DEPRECATED: This module has been moved
  # This shim will be removed after {grace_period} days
  # Please update imports to use canonical path
  
  import warnings
  warnings.warn(
      "{old_module} is deprecated, use {new_module} instead",
      DeprecationWarning,
      stacklevel=2
  )
  
  # Forward imports
  from {new_module} import *  # noqa: F401, F403
