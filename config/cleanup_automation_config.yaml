# Cleanup Automation Configuration
# Version: 1.0.0
# Generated: 2025-11-29

# Global Settings
global:
  dry_run: false
  verbose: true
  log_level: "INFO"
  log_file: ".cleanup_automation.log"

  # Auto-approval thresholds (per user preference: Balanced 75%+)
  auto_approval_threshold: 75
  require_manual_review_below: 75

  # Safety settings
  create_backups: true
  backup_directory: ".cleanup_backups"
  backup_retention_days: 90
  test_after_execution: true
  rollback_on_failure: true

# Scan Paths
scan_paths:
  - "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK/"
  - "modules/"
  - "core/"
  - "error/"
  - "scripts/"
  - "tests/"

# Exclusions (never scan/modify these)
exclusions:
  directories:
    - ".git/"
    - "__pycache__/"
    - ".pytest_cache/"
    - "node_modules/"
    - ".venv/"
    - "venv/"
    - "archive/"  # Already archived
    - ".cleanup_backups/"  # Our own backups

  file_patterns:
    - "*.pyc"
    - "*.pyo"
    - "*.db"
    - "*.db-shm"
    - "*.db-wal"
    - "*.log"
    - ".env"
    - "*.sqlite"

  files:
    - "README.md"
    - "LICENSE"
    - "CLAUDE.md"
    - ".gitignore"

# Pattern-Specific Configuration

patterns:
  EXEC-014:
    name: "Exact Duplicate Eliminator"
    enabled: true
    confidence: 95
    auto_approve: true
    priority: 0

    hash_algorithm: "SHA256"
    min_file_size_bytes: 1024  # 1 KB
    batch_size: 10

    # Canonical scoring weights (total = 100)
    scoring:
      location_tier: 40  # UETF > modules > core > archive
      recency: 30        # Newer = better
      import_count: 20   # More imports = canonical
      path_depth: 10     # Shallower = better

    # Location tier weights
    location_tiers:
      "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK/": 100
      "modules/": 70
      "core/": 50
      "error/": 50
      "engine/": 30
      "archive/": 10

  EXEC-015:
    name: "Stale File Archiver"
    enabled: true
    confidence: 85
    auto_approve: true  # But requires single review (75-89% tier)
    priority: 1

    staleness_threshold_score: 70  # Files â‰¥70 points archived
    grace_period_days: 30  # Symlinks kept for 30 days

    # Staleness scoring (total = 100)
    scoring:
      last_modified_days: 30  # â‰¥180 days = max points
      last_commit_days: 20
      reference_count: 20     # Inverted: 0 refs = max points
      location_tier: 10       # Inverted: archive/ = max points
      file_size: 10           # Smaller = higher points
      test_coverage: 10       # 0% coverage = max points

    # Whitelist (never archive these)
    whitelist_files:
      - "doc_id/**/*"  # Documentation registry
      - "CODEBASE_INDEX.md"
      - "*.schema.json"

  EXEC-016:
    name: "Import Path Standardizer"
    enabled: true
    confidence: 100
    auto_approve: true
    priority: 0

    migration_map_file: "config/import_migration_map.yaml"
    batch_size: 25
    test_after_batch: true
    preserve_shims: true
    shim_grace_period_days: 30

    # Dependency ordering
    dependency_order:
      - "tests/"      # Leaf modules first
      - "scripts/"
      - "modules/"
      - "core/"       # Root modules last

  EXEC-017:
    name: "Archive Consolidator"
    enabled: true
    confidence: 90
    auto_approve: true  # Single review required (75-89% tier)
    priority: 1

    target_archive_dir: "archive/consolidated/"
    compress_old_archives: true
    compression_format: "tar.gz"
    generate_index: true

    # Archive sources to consolidate
    source_archives:
      - "archive/legacy/AI_MANGER_archived_2025-11-22/"
      - "archive/legacy/pre_uet_migration/"
      - "archive/2025-11-26_root_archive/"
      - "archive/2025-11-26_developer/"
      - "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK/.migration/"

  EXEC-018:
    name: "Orphaned Module Detector"
    enabled: true
    confidence: 80
    auto_approve: false  # Manual review required (Tier 3)
    priority: 2

    # Detection criteria (all must be true)
    criteria:
      min_age_days: 90
      max_file_size_bytes: 51200  # 50 KB
      max_import_count: 0
      min_test_coverage: 0
      not_in_doc_registry: true
      not_in_codebase_index: true

    # Usage tracking before final decision
    usage_tracking_days: 14

    # Output format
    report_format: "json"
    report_file: "orphaned_modules_report.json"

  EXEC-019:
    name: "Shim Removal Automation"
    enabled: true
    confidence: 95
    auto_approve: true  # But only after grace period
    priority: 2

    min_shim_age_days: 30
    usage_check_days: 7  # Zero usage in last 7 days
    batch_size: 10

    # Shim identification pattern
    shim_pattern: "^from .+ import \\*$\\s*$"  # File with only import forwarding

  EXEC-020:
    name: "Directory Structure Optimizer"
    enabled: true
    confidence: 80
    auto_approve: false  # Manual review required (high impact)
    priority: 3

    target_structure: "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK/"

    # Phased execution
    phases:
      phase_1:
        name: "Move orphaned engine/"
        risk: "low"
        sources: ["engine/"]
        destination: "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK/core/engine/"

      phase_2:
        name: "Consolidate modules/"
        risk: "medium"
        sources: ["modules/"]
        destination: "UNIVERSAL_EXECUTION_TEMPLATES_FRAMEWORK/"
        create_shims: true

      phase_3:
        name: "Remove core/ shim layer"
        risk: "high"
        sources: ["core/"]
        action: "archive"  # Don't delete, archive
        grace_period_days: 60

# Validation Settings

validation:
  # Test suite settings
  test_command: "pytest -q tests/"
  test_required_pass_count: 196
  test_timeout_seconds: 300

  # Import validation
  import_check_command: "python scripts/paths_index_cli.py gate"
  import_check_required: true

  # Static analysis
  check_circular_imports: true
  check_broken_imports: true

  # Type checking (optional)
  run_mypy: false  # Set true if type checking desired
  mypy_command: "mypy --config-file pyproject.toml"

# Git Integration

git:
  # Commit settings
  commit_message_template: |
    {action}({pattern_id}): {description}

    {details}

    ðŸ¤– Generated with Claude Code
    Co-Authored-By: Claude <noreply@anthropic.com>

  # Batched commits
  create_feature_branch: false  # Execute in current branch
  branch_prefix: "cleanup/"

  # Rollback settings
  auto_rollback_on_failure: true
  keep_failed_commits: true  # For debugging

# Monitoring & Reporting

monitoring:
  # Progress tracking
  show_progress_bar: true
  update_interval_seconds: 5

  # Metrics collection
  collect_metrics: true
  metrics_file: ".cleanup_metrics.json"

  # Event emission
  emit_events: true
  event_log_file: ".cleanup_events.jsonl"

# Notifications (future enhancement)

notifications:
  enabled: false
  # Future: Slack, email, etc.

# Quality Gates Integration

quality_gates:
  # Pre-commit hooks
  install_pre_commit_hooks: false  # Manual for now

  # CI/CD integration
  generate_ci_config: false  # Manual for now

# Pattern Execution Order (4-Week Plan)

execution_schedule:
  week_1:
    - pattern: "EXEC-014"
      days: [1, 2]
      description: "Exact duplicates removal"

    - pattern: "EXEC-015"
      days: [3, 4]
      description: "Stale files archival"

  week_2:
    - pattern: "EXEC-016"
      days: [6, 7, 8, 9, 10, 11]
      description: "Import path standardization"

    - pattern: "EXEC-012"
      days: [12]
      description: "Module consolidation start"

  week_3:
    - pattern: "EXEC-017"
      days: [13, 14]
      description: "Archive consolidation"

    - pattern: "EXEC-018"
      days: [15, 16]
      description: "Orphan detection"

  week_4:
    - pattern: "EXEC-019"
      days: [20, 21]
      description: "Shim removal"

    - pattern: "EXEC-020"
      days: [22, 23, 24, 25, 26]
      description: "Directory structure optimization"
